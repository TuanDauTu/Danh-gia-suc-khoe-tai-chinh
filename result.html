<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt qu·∫£ ch·∫©n ƒëo√°n - S·ª©c Kh·ªèe T√†i Ch√≠nh</title>
    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü©∫</text></svg>">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/result.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/levels_data.js"></script>
</head>

<body>

    <!-- Header -->
    <header class="header">
        <nav class="container header-row" style="justify-content: space-between;">
            <a href="index.html" class="logo">
                <span style="font-size: 1.5rem;">ü©∫</span>
                S·ª©c Kh·ªèe T√†i Ch√≠nh
            </a>
            <!-- Main Menu -->
            <div style="display: flex; align-items: center;">
                <a href="https://beacons.ai/tuan.dau.tu" target="_blank" class="doctor-link">
                    <span style="font-size: 1.5rem;">üë®‚Äç‚öïÔ∏è</span>
                    B√°c sƒ© t√†i ch√≠nh
                </a>
            </div>

        </nav>
    </header>

    <script>
        // NgƒÉn ch·∫∑n ph√≠m t·∫Øt in (Ctrl+P ho·∫∑c Cmd+P)
        document.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p Email ·ªü cu·ªëi trang ƒë·ªÉ nh·∫≠n b·∫£n b√°o c√°o PDF ƒë·∫ßy ƒë·ªß v√† ƒë·∫πp m·∫Øt nh·∫•t!');
            }
        });
    </script>

    <main class="result-container">

        <!-- Ph·∫ßn 1: T·ªïng quan k·∫øt qu·∫£ (Gi·ªëng gi·∫•y x√©t nghi·ªám) -->
        <section class="diagnosis-paper">
            <div class="paper-header">
                <div class="doc-info">
                    <small>B√°c sƒ© ph·ª• tr√°ch</small>
                    <strong>Tu·∫•n ƒê·∫ßu T∆∞</strong>

                </div>
                <div class="date-info">
                    <small>Ng√†y ƒë√°nh gi√°</small>
                    <strong id="date-display">02/02/2026</strong>
                </div>
            </div>

            <!-- K·∫øt lu·∫≠n ch√≠nh -->
            <div class="diagnosis-summary text-center">
                <h1 style="color: #264653; font-size: 1.5rem; margin-bottom: 24px; text-transform: uppercase;">B√°o c√°o
                    k·∫øt qu·∫£</h1>
                <!-- C·∫•p ƒë·ªô trung b√¨nh ƒë√£ ƒë∆∞·ª£c di chuy·ªÉn xu·ªëng d∆∞·ªõi -->

                <!-- Bi·ªÉu ƒë·ªì k·∫øt qu·∫£ -->
                <div class="result-chart-wrapper" style="max-width: 600px; margin: 24px auto;">
                    <canvas id="resultChart"></canvas>
                    <div
                        style="display: flex; justify-content: center; gap: 15px; font-size: 0.8rem; margin-top: 10px; color: #64748b;">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <span
                                style="width: 10px; height: 10px; background: #2C6E73; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px #2C6E73;"></span>
                            <span>K·∫øt qu·∫£ c·ªßa b·∫°n</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <span
                                style="width: 10px; height: 10px; background: transparent; border: 1.5px dashed #FF6B6B; border-radius: 50%;"></span>
                            <span>Trung b√¨nh ng∆∞·ªùi test kh√°c</span>
                        </div>
                    </div>
                </div>

                <!-- Ph√¢n t√≠ch chi ti·∫øt -->
                <div id="aspects-analysis" class="aspects-container"
                    style="display: none; margin-top: 24px; text-align: left; background: #fff; border-radius: 8px; border: 1px solid #eee;">
                    <!-- C·∫ßn theo d√µi (<= 2) -->
                    <div id="weak-group" style="padding: 16px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #E63946; margin-bottom: 8px; font-size: 1rem;">‚ö†Ô∏è Nh·ªØng kh√≠a c·∫°nh c·∫ßn theo d√µi
                            (ƒëi·ªÉm th·∫•p)
                        </h4>
                        <ul id="weak-list" style="margin: 0; padding-left: 20px; color: #555;"></ul>
                    </div>

                    <!-- C·∫ßn ph√°t huy (>= 6) -->
                    <div id="strong-group" style="padding: 16px;">
                        <h4 style="color: #2A9D8F; margin-bottom: 8px; font-size: 1rem;">üåü Nh·ªØng kh√≠a c·∫°nh c·∫ßn ph√°t huy
                            (ƒëi·ªÉm cao)
                        </h4>
                        <ul id="strong-list" style="margin: 0; padding-left: 20px; color: #555;"></ul>
                    </div>

                    <!-- C·∫•p ƒë·ªô t·ªïng qu√°t (ƒê√£ ƒë∆∞·ª£c l√†m m·ªõi) -->
                    <div id="moved-level-badge"
                        style="margin: 24px 0; padding: 20px; background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%); border-radius: 12px; border: 1px solid #b3e0ff;">
                        <div
                            style="border-bottom: 1px solid rgba(0, 109, 117, 0.15); padding-bottom: 12px; margin-bottom: 12px; font-size: 1.1rem; color: #003a4d; font-weight: 600;">
                            ƒêi·ªÉm t·ªïng qu√°t c·ªßa b·∫°n: <strong id="level-val" style="color: #006d75; font-size: 1.4rem;">
                                <div class="tooltip-wrap"
                                    style="display: inline-block; position: relative; cursor: help; vertical-align: middle;">
                                    <span style="color: #006d75; font-size: 1.1rem; margin-right: 4px;">‚ìò</span>
                                    <div class="tooltip-content"
                                        style="display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); width: 280px; background: #264653; color: #fff; padding: 12px; border-radius: 8px; font-size: 0.85rem; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.15); margin-bottom: 10px; line-height: 1.4; font-weight: normal; text-align: left;">
                                        ƒêi·ªÉm ƒë∆∞·ª£c t√≠nh to√°n d·ª±a tr√™n m√¥ h√¨nh t√†i ch√≠nh nh√¢n qu·∫£ 347 c·ªßa <a
                                            href="https://www.facebook.com/TuanDauTu68/" target="_blank"
                                            style="color: #4CC9F0; text-decoration: underline;">Tu·∫•n ƒê·∫ßu T∆∞</a>.
                                        <div
                                            style="position: absolute; top: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: #264653 transparent transparent transparent;">
                                        </div>
                                    </div>
                                    <style>
                                        .tooltip-wrap:hover .tooltip-content {
                                            display: block !important;
                                        }
                                    </style>
                                </div>
                                ---/7
                            </strong>
                        </div>
                        <div style="font-size: 1rem; color: #006d75; line-height: 1.6; text-align: justify;">
                            üéâ <strong>Ch√∫c m·ª´ng!</strong> <span style="color: #e63946; font-weight: 700;">B·∫°n ƒë√£ ho√†n
                                th√†nh b∆∞·ªõc quan tr·ªçng nh·∫•t: Bi·∫øt ƒë∆∞·ª£c ch√≠nh x√°c b·∫£n th√¢n ƒëang ·ªü v·ªã tr√≠ n√†o tr√™n b·∫£n ƒë·ªì
                                t√†i ch√≠nh, vi·ªác m√† h·∫ßu h·∫øt m·ªçi ng∆∞·ªùi kh√¥ng bi·∫øt.</span> <strong>H∆°n 80% m·ªçi ng∆∞·ªùi ngo√†i
                                kia ƒëang ƒëi l·∫°c m√† kh√¥ng h·ªÅ hay bi·∫øt ƒë√≠ch ƒë·∫øn c·ªßa m√¨nh.</strong>
                        </div>
                    </div>

                    <!-- Th√°p t√†i ch√≠nh 7 c·∫•p ƒë·ªô -->
                    <div class="pyramid-container">
                        <h4 class="pyramid-title">Th√°p T√†i Ch√≠nh 7 C·∫•p ƒê·ªô</h4>
                        <div class="pyramid-wrapper">
                            <div class="pyramid-level level-7">
                                C·∫•p 7: T·ª± do t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: Di s·∫£n</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ Ti·ªÅn kh√¥ng c√≤n l√† √°p l·ª±c<br>
                                        ‚Ä¢ S·ªëng theo gi√° tr·ªã c√° nh√¢n<br>
                                        ‚Ä¢ Ra quy·∫øt ƒë·ªãnh phi c·∫£m x√∫c<br>
                                        ‚Ä¢ T∆∞ duy trao ƒëi ‚Äì ph·ª•ng s·ª±
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: < 30% thu nh·∫≠p<br>
                                            ‚Ä¢ Ti·∫øt ki·ªám: > 100% (v√†o CPTY)<br>
                                            ‚Ä¢ N·ª£: < 20% (ƒë√≤n b·∫©y)<br>
                                                ‚Ä¢ T√†i s·∫£n: > 25 nƒÉm chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-6">
                                C·∫•p 6: ƒê·ªôc l·∫≠p t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: T·ª± do</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ Kh√¥ng c·∫ßn l√†m v√¨ ti·ªÅn<br>
                                        ‚Ä¢ Ch·ªß ƒë·ªông th·ªùi gian<br>
                                        ‚Ä¢ Thu nh·∫≠p th·ª• ƒë·ªông r√µ r·ªát<br>
                                        ‚Ä¢ Ra quy·∫øt ƒë·ªãnh r·∫•t ƒëi·ªÅm tƒ©nh
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: 30-50% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: > 100% (v√†o CPTY)<br>
                                        ‚Ä¢ N·ª£: < 20% (ƒë√≤n b·∫©y)<br>
                                            ‚Ä¢ T√†i s·∫£n: 10-25 nƒÉm chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-5">
                                C·∫•p 5: V·ªØng v√†ng t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: Sung t√∫c</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ Ch·ªß ƒë·ªông v·ªõi ti·ªÅn<br>
                                        ‚Ä¢ C√≥ chi·∫øn l∆∞·ª£c r√µ r√†ng<br>
                                        ‚Ä¢ Kh√¥ng c√≤n ph·ª• thu·ªôc l∆∞∆°ng<br>
                                        ‚Ä¢ T∆∞ duy t√†i s·∫£n thay cho ti√™u d√πng
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: 40-60% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: 30-100%<br>
                                        ‚Ä¢ N·ª£: < 20%<br>
                                            ‚Ä¢ T√†i s·∫£n: 5-10 nƒÉm chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-4">
                                C·∫•p 4: ·ªîn ƒë·ªãnh t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: T·ª± ch·ªß</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ D√≤ng ti·ªÅn ƒë·ªÅu ƒë·∫∑n<br>
                                        ‚Ä¢ √çt stress v√¨ ti·ªÅn<br>
                                        ‚Ä¢ Chi ti√™u c√≥ k·ª∑ lu·∫≠t<br>
                                        ‚Ä¢ T∆∞ duy d√†i h·∫°n h√¨nh th√†nh
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: 50-70% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: 20-50%<br>
                                        ‚Ä¢ N·ª£: < 30%<br>
                                            ‚Ä¢ T√†i s·∫£n: 1-5 nƒÉm chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-3">
                                C·∫•p 3: An to√†n t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: An t√¢m</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ B·∫Øt ƒë·∫ßu c√≥ c·∫£m gi√°c y√™n t√¢m<br>
                                        ‚Ä¢ Bi·∫øt k·∫ø ho·∫°ch h√≥a chi ti√™u<br>
                                        ‚Ä¢ C√≥ qu·ªπ d·ª± ph√≤ng c∆° b·∫£n<br>
                                        ‚Ä¢ √ù th·ª©c ti·∫øt ki·ªám r√µ r√†ng
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: 70-90% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: 10-20%<br>
                                        ‚Ä¢ N·ª£: 20-40% thu nh·∫≠p<br>
                                        ‚Ä¢ T√†i s·∫£n: 6-12 th√°ng chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-2">
                                C·∫•p 2: Sinh t·ªìn t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: D·ªÖ v·ª°</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ Th·∫Øt ch·∫∑t nh∆∞ng m·ªát m·ªèi<br>
                                        ‚Ä¢ S·ªëng theo k·ª≥ l∆∞∆°ng<br>
                                        ‚Ä¢ Kh√¥ng d√°m nghƒ© d√†i h·∫°n<br>
                                        ‚Ä¢ Thu nh·∫≠p ph·ª• thu·ªôc 1 ngu·ªìn
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: 90-110% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: 0-10%<br>
                                        ‚Ä¢ N·ª£: 30-50% thu nh·∫≠p<br>
                                        ‚Ä¢ T√†i s·∫£n: 1-6 th√°ng chi ph√≠
                                    </div>
                                </div>
                            </div>
                            <div class="pyramid-level level-1">
                                C·∫•p 1: Kh·ªßng ho·∫£ng t√†i ch√≠nh
                                <div class="level-tooltip">
                                    <strong
                                        style="font-size: 0.95rem; display: block; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">V·ªã
                                        th·∫ø: Nguy k·ªãch</strong>

                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #FFD166;">ƒê·∫∑c ƒëi·ªÉm:</strong><br>
                                        ‚Ä¢ Lu√¥n cƒÉng th·∫≥ng v√¨ thi·∫øu ti·ªÅn<br>
                                        ‚Ä¢ Ph·∫£n ·ª©ng b·∫£n nƒÉng, ch·ªØa ch√°y<br>
                                        ‚Ä¢ M·∫•t ki·ªÉm so√°t d√≤ng ti·ªÅn<br>
                                        ‚Ä¢ N√© tr√°nh ƒë·ªëi di·ªán s·ª± th·∫≠t
                                    </div>

                                    <div
                                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.3);">
                                        <strong style="color: #FFD166;">ƒêo l∆∞·ªùng:</strong><br>
                                        ‚Ä¢ Chi ph√≠: > 110% thu nh·∫≠p<br>
                                        ‚Ä¢ Ti·∫øt ki·ªám: 0ƒë<br>
                                        ‚Ä¢ N·ª£: > 50% thu nh·∫≠p<br>
                                        ‚Ä¢ T√†i s·∫£n: 0-1 th√°ng chi ph√≠
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chi ti·∫øt ch·∫©n ƒëo√°n c·∫•p ƒë·ªô -->
                <div id="level-diagnosis-wrapper"
                    style="display: none; padding: 16px; background-color: #f8f9fa; border-bottom: 1px dashed #ddd;">
                    <div id="level-diagnosis-content">
                        <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c JS ƒëi·ªÅn v√†o -->
                    </div>
                </div>
            </div>
            </div>

            <!-- L·ªùi tr·∫•n an -->
            <div class="doctor-note">
                <div class="note-icon">üí¨</div>
                <div class="note-content">
                    <h4>L·ªùi nh·∫Øn t·ª´ b√°c sƒ©:</h4>
                    <p id="doctor-msg">
                        "ƒê·ª´ng qu√° lo l·∫Øng. K·∫øt qu·∫£ n√†y cho th·∫•y b·∫°n ƒëang ch·ªãu √°p l·ª±c, nh∆∞ng ch∆∞a r∆°i v√†o v√πng nguy hi·ªÉm.
                        C·∫£m gi√°c m·ªát m·ªèi c·ªßa b·∫°n ƒë·∫øn t·ª´ vi·ªác <strong>thi·∫øu m·ªôt k·∫ø ho·∫°ch d·ª± ph√≤ng</strong> r√µ r√†ng, ch·ª©
                        kh√¥ng h·∫≥n do thu nh·∫≠p th·∫•p.
                        ƒê√¢y l√† 'tri·ªáu ch·ª©ng' r·∫•t ph·ªï bi·∫øn v√† ho√†n to√†n c√≥ th·ªÉ ƒëi·ªÅu tr·ªã d·ª©t ƒëi·ªÉm trong 3-6 th√°ng."
                    </p>
                </div>
            </div>

            <!-- B·∫¢N FREE NOTICE -->
            <!-- B·∫¢N FREE NOTICE -->
            <div class="free-version-note"
                style="margin-top: 20px; background-color: #fff; padding: 0; border-radius: 12px; border: 1px solid #cbd5e1; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                <h4
                    style="color: #0f172a; margin: 0; padding: 15px 20px; font-size: 1.1rem; background: #fff; border-bottom: 2px solid #e2e8f0; text-align: center; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700;">
                    üìä Ph·∫°m vi b√°o c√°o b·∫°n ƒëang xem
                </h4>
                <style>
                    /* Highlight Full Version Column */
                    .free-version-note table th:nth-child(3),
                    .free-version-note table td:nth-child(3) {
                        background-color: #f0fdfa !important;
                        /* Light Teal Background */
                    }

                    .free-version-note table th:nth-child(3) {
                        background-color: #0d9488 !important;
                        /* Teal Header */
                        color: white !important;
                        border-top-left-radius: 8px;
                        border-top-right-radius: 8px;
                        position: relative;
                        box-shadow: 0 -4px 10px rgba(13, 148, 136, 0.1);
                    }

                    .free-version-note table td:nth-child(3) {
                        border-left: 1px solid #ccfbf1;
                        border-right: 1px solid #ccfbf1;
                        font-weight: 500;
                    }

                    /* Add a "Recommended" badge on mobile/desktop */
                    .free-version-note table th:nth-child(3)::before {
                        content: "‚òÖ Khuy√™n d√πng";
                        position: absolute;
                        top: -24px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #0d9488;
                        color: white;
                        font-size: 0.75rem;
                        padding: 4px 12px;
                        border-radius: 12px 12px 0 0;
                        font-weight: 700;
                        white-space: nowrap;
                    }
                </style>
                <div style="overflow-x: auto; padding-top: 50px;">
                    <table
                        style="width: 100%; border-collapse: collapse; font-family: 'Be Vietnam Pro', sans-serif; min-width: 500px;">
                        <thead>
                            <tr style="background-color: #f8fafc;">
                                <th
                                    style="text-align: left; padding: 12px 15px; border-right: 1px solid #e2e8f0; color: #475569; font-weight: 600; width: 50%;">
                                    H·∫°ng m·ª•c th√¥ng tin</th>
                                <th
                                    style="text-align: center; padding: 12px 10px; border-right: 1px solid #e2e8f0; color: #000000; font-weight: 700; width: 25%; position: relative;">
                                    <div
                                        style="position: absolute; top: -28px; left: 50%; transform: translateX(-50%); white-space: nowrap; color: #ef4444; font-size: 0.75rem; font-weight: 800; display: flex; flex-direction: column; align-items: center;">
                                        <span>B·∫†N ƒêANG ·ªû ƒê√ÇY</span>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 17L7 12H17L12 17ZM12 5V12V5Z" />
                                            <!-- Custom simplified arrow -->
                                            <path d="M12 21L6 14H18L12 21Z" />
                                            <path d="M11 3H13V15H11V3Z" />
                                        </svg>
                                    </div>
                                    B·∫£n Free<br><span style="font-size: 0.8em; font-weight: normal;">(Mi·ªÖn ph√≠)</span>
                                </th>
                                <th
                                    style="text-align: center; padding: 12px 10px; color: #ffffff; background-color: #0d9488; font-weight: 700; width: 25%; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                                    B·∫£n Full<br><span style="font-size: 0.8em; font-weight: normal;">(Chuy√™n
                                        s√¢u)</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Row 1 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    1. üéØ C·∫•p ƒë·ªô t√†i ch√≠nh</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                                    <span style="color: #000000; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 2 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    2. üß† H·ªì s∆° t√†i ch√≠nh t·ªïng quan</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                                    <span style="color: #000000; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 3 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    3. üöß ƒêi·ªÉm ngh·∫Ωn ch√≠nh</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                                    <span style="color: #000000; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 4 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    4. üìà Bi·ªÉu ƒë·ªì v·ªã tr√≠</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                                    <span style="color: #000000; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 5 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    5. ‚ö†Ô∏è R·ªßi ro ti·ªÅm ·∫©n</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0;">
                                    <span style="color: #000000; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 6 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    6. üí° L·ªô tr√¨nh 90 ng√†y c·∫£i thi·ªán t√†i ch√≠nh</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 7 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    7. üîç Ph√¢n t√≠ch ƒêi·ªÉm m·∫°nh - ƒêi·ªÉm y·∫øu<br><span
                                        style="font-size:0.85em; color:#64748b;">(Chi ti√™u - Thu nh·∫≠p - N·ª£ - T√†i
                                        s·∫£n)</span></td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 8 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    8. üß† Ph√¢n t√≠ch t√¢m l√Ω h·ªçc h√†nh vi<br><span
                                        style="font-size:0.85em; color:#64748b;">(G·ªëc r·ªÖ v·∫•n ƒë·ªÅ)</span></td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 9 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    9. ‚úÖ Checklist h√†nh ƒë·ªông c·∫£i thi·ªán<br><span
                                        style="font-size:0.85em; color:#64748b;">(C·ª• th·ªÉ t·ª´ng b∆∞·ªõc)</span></td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 10 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155;">
                                    10. üéØ ƒê·ªãnh h∆∞·ªõng c√° nh√¢n h√≥a</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td style="text-align: center; border-bottom: 1px solid #e2e8f0;"><span
                                        style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span></td>
                            </tr>
                            <!-- Row 11 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155; height: 60px; vertical-align: middle;">
                                    11. ‚ö†Ô∏è Ph√¢n t√≠ch R·ªßi ro cho (Chi ti√™u - Thu nh·∫≠p - N·ª£ - T√†i s·∫£n)</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1; vertical-align: middle;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; vertical-align: middle;">
                                    <span style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                            </tr>
                            <!-- Row 12 -->
                            <tr>
                                <td
                                    style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #334155; height: 60px; vertical-align: middle;">
                                    12. üìÇ
                                    File PDF t·∫£i v·ªÅ</td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; color: #cbd5e1; vertical-align: middle;">
                                    <span style="color: #ef4444; font-weight: 700; font-size: 1.2rem;">‚úï</span>
                                </td>
                                <td
                                    style="text-align: center; border-bottom: 1px solid #e2e8f0; vertical-align: middle;">
                                    <span style="color: #0d9488; font-weight: bold; font-size: 1.5rem;">‚úì</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>


                <!-- CTA Upgrade Section -->
                <!-- CTA Upgrade Section (Premium Redesign) -->
                <div class="upgrade-cta-section"
                    style="position: relative; margin-top: 30px; padding: 2px; border-radius: 24px; background: linear-gradient(135deg, #0d9488 0%, #3b82f6 50%, #8b5cf6 100%); box-shadow: 0 20px 50px -10px rgba(15, 23, 42, 0.3);">

                    <div
                        style="background: #0f172a; border-radius: 22px; padding: 50px 30px; text-align: center; position: relative; overflow: hidden;">

                        <!-- Glow Effect -->
                        <div
                            style="position: absolute; top: -100px; left: 50%; transform: translateX(-50%); width: 400px; height: 400px; background: radial-gradient(circle, rgba(13, 148, 136, 0.15) 0%, transparent 70%); pointer-events: none;">
                        </div>

                        <!-- Badge -->
                        <div style="margin-bottom: 25px;">
                            <span
                                style="display: inline-flex; align-items: center; gap: 6px; background: rgba(13, 148, 136, 0.15); color: #2dd4bf; padding: 8px 18px; border-radius: 30px; font-weight: 700; font-size: 0.85rem; border: 1px solid rgba(45, 212, 191, 0.3); text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 20px rgba(45, 212, 191, 0.15);">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                                </svg>
                                ∆Øu ƒë√£i gi·ªõi h·∫°n
                            </span>
                        </div>

                        <!-- Title -->
                        <h3
                            style="font-size: 2.2rem; font-weight: 800; color: #f8fafc; margin-bottom: 15px; line-height: 1.25;">
                            M·ªü kh√≥a <span
                                style="background: linear-gradient(to right, #2dd4bf, #60a5fa); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">B√°o
                                C√°o Chuy√™n S√¢u</span><br>& Checklist h√†nh ƒë·ªông
                        </h3>

                        <!-- Description -->
                        <p
                            style="color: #94a3b8; font-size: 1.1rem; line-height: 1.6; max-width: 600px; margin: 0 auto 35px;">
                            Nh·∫≠n ngay b·∫£n ph√¢n t√≠ch chi ti·∫øt <strong style="color: #fff;">20+ trang</strong>, bi·ªÉu ƒë·ªì
                            chuy√™n s√¢u v√† checklist h√†nh ƒë·ªông c√° nh√¢n h√≥a d√†nh ri√™ng cho b·∫°n.
                        </p>

                        <!-- Price Section -->
                        <div style="margin-bottom: 40px; position: relative;">
                            <div style="display: flex; align-items: baseline; justify-content: center; gap: 15px;">
                                <span
                                    style="font-size: 4rem; font-weight: 800; color: #ffffff; line-height: 1; text-shadow: 0 0 40px rgba(45, 212, 191, 0.2); letter-spacing: -1px; display: inline-block; animation: price-pulse 1.5s infinite;">199.000ƒë</span>
                                <div style="text-align: left;">
                                    <span
                                        style="display: block; font-size: 1.2rem; color: #64748b; text-decoration: line-through; font-weight: 500;">999.000ƒë</span>
                                </div>
                            </div>
                            <!-- Savings Badge -->
                            <div style="position: absolute; top: -10px; right: 50%; transform: translateX(110px);">
                                <style>
                                    @keyframes blink-badge {
                                        0% {
                                            transform: rotate(10deg) scale(1);
                                            box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7);
                                        }

                                        70% {
                                            transform: rotate(10deg) scale(1.1);
                                            box-shadow: 0 0 0 10px rgba(244, 63, 94, 0);
                                        }

                                        100% {
                                            transform: rotate(10deg) scale(1);
                                            box-shadow: 0 0 0 0 rgba(244, 63, 94, 0);
                                        }
                                    }

                                    @keyframes button-pulse {
                                        0% {
                                            transform: scale(1);
                                            box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.4), 0 0 0 0 rgba(13, 148, 136, 0.7);
                                        }

                                        70% {
                                            transform: scale(1.05);
                                            box-shadow: 0 15px 35px -5px rgba(13, 148, 136, 0.6), 0 0 0 10px rgba(13, 148, 136, 0);
                                        }

                                        100% {
                                            transform: scale(1);
                                            box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.4), 0 0 0 0 rgba(13, 148, 136, 0);
                                        }
                                    }

                                    @keyframes price-pulse {
                                        0% {
                                            transform: scale(1);
                                            text-shadow: 0 0 40px rgba(45, 212, 191, 0.2);
                                        }

                                        70% {
                                            transform: scale(1.05);
                                            text-shadow: 0 0 60px rgba(45, 212, 191, 0.8), 0 0 20px rgba(45, 212, 191, 0.5);
                                        }

                                        100% {
                                            transform: scale(1);
                                            text-shadow: 0 0 40px rgba(45, 212, 191, 0.2);
                                        }
                                    }
                                </style>
                                <span
                                    style="background: #f43f5e; color: white; font-size: 0.75rem; font-weight: 800; padding: 4px 8px; border-radius: 6px; transform: rotate(10deg); display: inline-block; animation: blink-badge 1.5s infinite;">TI·∫æT
                                    KI·ªÜM 80%</span>
                            </div>
                        </div>

                        <!-- Button -->
                        <button onclick="openPaymentModal()"
                            style="background: linear-gradient(to right, #0d9488, #0891b2); color: white; border: none; padding: 20px 45px; font-size: 1.25rem; font-weight: 700; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.4); display: inline-flex; align-items: center; gap: 12px; width: 100%; max-width: 380px; justify-content: center; position: relative; overflow: hidden; transform: translateY(0); animation: button-pulse 1.5s infinite;">
                            <span style="position: relative; z-index: 1;">M·ªü kh√≥a ngay</span>
                            <svg style="position: relative; z-index: 1;" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7" />
                            </svg>
                        </button>

                        <!-- JS for hover effect -->
                        <script>
                            document.querySelector('.upgrade-cta-section button').onmouseover = function () {
                                this.style.transform = 'translateY(-2px)';
                                this.style.boxShadow = '0 15px 35px -5px rgba(13, 148, 136, 0.6)';
                            };
                            document.querySelector('.upgrade-cta-section button').onmouseout = function () {
                                this.style.transform = 'translateY(0)';
                                this.style.boxShadow = '0 10px 30px -5px rgba(13, 148, 136, 0.4)';
                            };
                        </script>

                        <!-- Trust Badges -->
                        <div
                            style="margin-top: 30px; display: flex; align-items: center; justify-content: center; gap: 25px; flex-wrap: wrap;">
                            <span
                                style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #64748b; font-weight: 500;">
                                <div style="background: rgba(255,255,255,0.05); padding: 5px; border-radius: 50%;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#2dd4bf"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                </div>
                                Thanh to√°n an to√†n
                            </span>
                            <span
                                style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #64748b; font-weight: 500;">
                                <div style="background: rgba(255,255,255,0.05); padding: 5px; border-radius: 50%;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#2dd4bf"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                </div>
                                Nh·∫≠n k·∫øt qu·∫£ trong v√≤ng 24h
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Testimonial Section -->
                <!-- Testimonial Section (Chat Style) -->
                <section class="testimonial-section" style="margin-top: 60px; padding: 0 10px;">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <span
                            style="background: #e0f2f1; color: #00695c; padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">Feedback
                            th·ª±c t·∫ø</span>
                        <h3 style="color: #264653; font-size: 1.8rem; margin-top: 15px; font-weight: 800;">C√¢u chuy·ªán
                            thay ƒë·ªïi t·ª´ ng∆∞·ªùi d√πng th·∫≠t</h3>
                        <p style="color: #64748b; max-width: 600px; margin: 10px auto;">K·∫øt qu·∫£ th·ª±c t·∫ø sau khi √°p d·ª•ng
                            B√°o c√°o chuy√™n s√¢u.</p>
                    </div>

                    <div class="testimonial-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; border: 2px dashed #0d9488; padding: 30px; border-radius: 24px;">

                        <style>
                            .chat-card {
                                background: #fff;
                                border-radius: 20px;
                                border: 2px dashed #0d9488;
                                overflow: hidden;
                                box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
                                display: flex;
                                flex-direction: column;
                                transition: transform 0.2s;
                            }

                            .chat-card:hover {
                                transform: translateY(-3px);
                                box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.1);
                            }

                            .chat-header {
                                background: #f8fafc;
                                padding: 15px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                border-bottom: 1px solid #e2e8f0;
                            }

                            .user-status {
                                width: 10px;
                                height: 10px;
                                background: #22c55e;
                                border-radius: 50%;
                                border: 2px solid white;
                                position: absolute;
                                bottom: 0;
                                right: 0;
                            }

                            .chat-body {
                                padding: 20px;
                                background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
                                background-size: 20px 20px;
                                background-color: #ffffff;
                                flex-grow: 1;
                                font-size: 0.9rem;
                            }

                            .message {
                                margin-bottom: 15px;
                                max-width: 85%;
                                position: relative;
                                clear: both;
                            }

                            .message.user {
                                float: left;
                                background: #f1f5f9;
                                color: #334155;
                                padding: 10px 15px;
                                border-radius: 15px 15px 15px 0;
                            }

                            /* Base App Message Style */
                            .message.app {
                                float: right;
                                color: white;
                                padding: 10px 15px;
                                border-radius: 15px 15px 0 15px;
                                text-align: right;
                            }

                            /* Base Result Message Style */
                            .message.result {
                                float: left;
                                padding: 10px 15px;
                                border-radius: 15px 15px 15px 0;
                                font-weight: 500;
                                border: 1px solid;
                            }

                            /* Theme: Teal (Default) */
                            .theme-teal .chat-header {
                                background: rgba(13, 148, 136, 0.1);
                                border-bottom-color: rgba(13, 148, 136, 0.2);
                            }

                            .theme-teal .message.app {
                                background: #0d9488;
                            }

                            .theme-teal .message.result {
                                background: #ecfdf5;
                                color: #065f46;
                                border-color: #6ee7b7;
                            }

                            .theme-teal .user-status {
                                background: #0d9488;
                            }

                            .theme-teal .chat-card:hover {
                                box-shadow: 0 15px 35px -5px rgba(13, 148, 136, 0.15);
                                border-color: rgba(13, 148, 136, 0.3);
                            }

                            /* Theme: Blue */
                            .theme-blue .chat-header {
                                background: rgba(37, 99, 235, 0.1);
                                border-bottom-color: rgba(37, 99, 235, 0.2);
                            }

                            .theme-blue .message.app {
                                background: #2563eb;
                            }

                            .theme-blue .message.result {
                                background: #eff6ff;
                                color: #1e40af;
                                border-color: #93c5fd;
                            }

                            .theme-blue .user-status {
                                background: #2563eb;
                            }

                            .theme-blue .chat-card:hover {
                                box-shadow: 0 15px 35px -5px rgba(37, 99, 235, 0.15);
                                border-color: rgba(37, 99, 235, 0.3);
                            }

                            /* Theme: Orange */
                            .theme-orange .chat-header {
                                background: rgba(234, 88, 12, 0.1);
                                border-bottom-color: rgba(234, 88, 12, 0.2);
                            }

                            .theme-orange .message.app {
                                background: #ea580c;
                            }

                            .theme-orange .message.result {
                                background: #fff7ed;
                                color: #9a3412;
                                border-color: #fdba74;
                            }

                            .theme-orange .user-status {
                                background: #ea580c;
                            }

                            .theme-orange .chat-card:hover {
                                box-shadow: 0 15px 35px -5px rgba(234, 88, 12, 0.15);
                                border-color: rgba(234, 88, 12, 0.3);
                            }

                            /* Theme: Purple */
                            .theme-purple .chat-header {
                                background: rgba(147, 51, 234, 0.1);
                                border-bottom-color: rgba(147, 51, 234, 0.2);
                            }

                            .theme-purple .message.app {
                                background: #9333ea;
                            }

                            .theme-purple .message.result {
                                background: #faf5ff;
                                color: #6b21a8;
                                border-color: #d8b4fe;
                            }

                            .theme-purple .user-status {
                                background: #9333ea;
                            }

                            .theme-purple .chat-card:hover {
                                box-shadow: 0 15px 35px -5px rgba(147, 51, 234, 0.15);
                                border-color: rgba(147, 51, 234, 0.3);
                            }

                            .time-label {
                                font-size: 0.7rem;
                                color: #94a3b8;
                                text-align: center;
                                margin: 10px 0;
                                clear: both;
                                display: block;
                            }

                            /* --- NEW TESTIMONIAL FORMATS --- */

                            /* Format 2: Classic Review Card */
                            .review-card {
                                background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
                                border-radius: 16px;
                                padding: 24px;
                                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
                                border: 2px dashed #3b82f6;
                                display: flex;
                                flex-direction: column;
                                transition: transform 0.3s;
                            }

                            .review-card:hover {
                                transform: translateY(-3px);
                                box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1);
                            }

                            .review-stars {
                                color: #F59E0B;
                                margin-bottom: 12px;
                                font-size: 1.1rem;
                            }

                            .review-title {
                                margin: 0 0 8px 0;
                                font-size: 1.1rem;
                                color: #1e293b;
                                font-weight: 800;
                            }

                            .review-text {
                                color: #475569;
                                font-size: 0.95rem;
                                line-height: 1.6;
                                font-style: italic;
                                margin-bottom: 20px;
                                flex-grow: 1;
                            }

                            .review-author {
                                display: flex;
                                align-items: center;
                                gap: 12px;
                                margin-top: auto;
                                border-top: 1px solid #f1f5f9;
                                padding-top: 16px;
                            }

                            .review-author img {
                                width: 40px;
                                height: 40px;
                                border-radius: 50%;
                            }

                            .review-author div {
                                display: flex;
                                flex-direction: column;
                                font-size: 0.9rem;
                            }

                            .review-author span {
                                font-size: 0.8rem;
                                color: #94a3b8;
                            }

                            /* Format 3: Impact/Result Card */
                            .impact-card {
                                background: #fff7ed;
                                /* Orange tint background */
                                border-radius: 16px;
                                padding: 20px;
                                border: 2px dashed #fdba74;
                                position: relative;
                            }

                            .impact-header {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin-bottom: 16px;
                            }

                            .impact-badge {
                                background: #ea580c;
                                color: white;
                                padding: 4px 10px;
                                border-radius: 12px;
                                font-size: 0.75rem;
                                font-weight: 800;
                            }

                            .impact-user {
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                font-size: 0.9rem;
                            }

                            .impact-user img {
                                width: 32px;
                                height: 32px;
                                border-radius: 50%;
                                border: 2px solid white;
                            }

                            .impact-body {
                                display: flex;
                                flex-direction: column;
                                gap: 8px;
                            }

                            .impact-row {
                                display: flex;
                                gap: 10px;
                                font-size: 0.9rem;
                                align-items: flex-start;
                            }

                            .impact-row.before p {
                                color: #64748b;
                                margin: 0;
                            }

                            .impact-row.after p {
                                color: #9a3412;
                                margin: 0;
                                font-weight: 500;
                            }

                            .impact-row .icon {
                                flex-shrink: 0;
                                margin-top: 2px;
                            }

                            .impact-arrow {
                                text-align: center;
                                color: #ea580c;
                                font-size: 0.8rem;
                                font-weight: 700;
                                margin: 4px 0;
                            }

                            /* Format 4: Minimal Quote */
                            .quote-card {
                                background: linear-gradient(135deg, #7e22ce, #a855f7);
                                color: #ffffff !important;
                                border-radius: 16px;
                                padding: 24px;
                                position: relative;
                                display: flex;
                                flex-direction: column;
                                justify-content: center;
                                text-align: center;
                                box-shadow: 0 10px 25px -5px rgba(126, 34, 206, 0.4);
                            }

                            .quote-card p,
                            .quote-card strong,
                            .quote-card span,
                            .quote-card div {
                                color: #ffffff !important;
                            }

                            .quote-mark {
                                font-size: 4rem;
                                line-height: 0.5;
                                font-family: 'Times New Roman', serif;
                                opacity: 0.3;
                                margin-bottom: 10px;
                                color: #ffffff !important;
                            }

                            .quote-content {
                                margin-bottom: 16px;
                                font-size: 1rem;
                                line-height: 1.6;
                                opacity: 1;
                                color: #ffffff !important;
                            }

                            .quote-content .highlight {
                                background: rgba(255, 255, 255, 0.25);
                                padding: 2px 6px;
                                font-weight: 700;
                                border-radius: 4px;
                                color: #ffffff !important;
                                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                            }

                            .quote-author {
                                font-size: 0.9rem;
                                opacity: 0.9;
                                margin-top: auto;
                                color: #ffffff !important;
                            }
                        </style>

                        <!-- Chat 1 -->
                        <div class="chat-card theme-teal">
                            <div class="chat-header">
                                <div style="position: relative; width: 45px; height: 45px;">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"
                                        style="width: 100%; border-radius: 50%;">
                                    <div class="user-status"></div>
                                </div>
                                <div>
                                    <div style="font-weight: 700; color: #1e293b;">Ho√†ng Minh</div>
                                    <div style="font-size: 0.8rem; color: #64748b;">Freelancer ‚Ä¢ 28 tu·ªïi</div>
                                </div>
                            </div>
                            <div class="chat-body">
                                <div class="message user">
                                    B√°c sƒ© ∆°i, em thu nh·∫≠p c≈©ng kh√° m√† kh√¥ng hi·ªÉu sao cu·ªëi th√°ng to√†n h·∫øt ti·ªÅn, ch·∫£ d∆∞
                                    ƒë·ªìng n√†o. üòì
                                </div>
                                <div class="message app">
                                    ƒê√£ g·ª≠i B√°o c√°o Full. Minh xem k·ªπ ph·∫ßn <strong>"ƒêi·ªÉm m√π chi ti√™u"</strong> v√† l√†m
                                    theo Checklist trang 15 nh√©. üìò
                                </div>
                                <div class="time-label">1 th√°ng sau...</div>
                                <div class="message result">
                                    Wow! Em l√†m theo ƒë∆∞·ª£c 1 th√°ng. C·∫Øt ƒë∆∞·ª£c m·ªõ chi ti√™u v√¥ b·ªï, <strong>d∆∞ h·∫≥n 5
                                        tri·ªáu</strong> lu√¥n! C·∫£m ∆°n b√°c sƒ©! üéâ
                                </div>
                            </div>
                        </div>

                        <!-- TESTIMONIAL 2: CLASSIC REVIEW CARD (Thu H√†) -->
                        <div class="review-card">
                            <div class="review-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                            <h4 class="review-title">"Gi·∫•c m∆° an c∆∞ th√†nh th·∫≠t!"</h4>
                            <p class="review-text">
                                "M√¨nh mu·ªën mua nh√† qu√° m√† s·ª£ vay n·ª£. Nh·ªù B√°c sƒ© ph√¢n t√≠ch d√≤ng ti·ªÅn v√† ch·ªâ ra c√°ch d√πng
                                <strong>'N·ª£ t·ªët'</strong>, m√¨nh ƒë√£ t·ª± tin ch·ªët cƒÉn chung c∆∞ sau 2 tu·∫ßn. C·∫£m ∆°n team r·∫•t
                                nhi·ªÅu!"
                            </p>
                            <div class="review-author">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Annie" alt="Thu H√†">
                                <div>
                                    <strong>Thu H√†</strong>
                                    <span>NV VƒÉn ph√≤ng ‚Ä¢ 32 tu·ªïi</span>
                                </div>
                            </div>
                        </div>

                        <!-- TESTIMONIAL 3: IMPACT/RESULT CARD (ƒê·ª©c Th√†nh) -->
                        <div class="impact-card">
                            <div class="impact-header">
                                <div class="impact-badge">CASE STUDY</div>
                                <div class="impact-user">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Robert" alt="ƒê·ª©c Th√†nh">
                                    <div>
                                        <strong>ƒê·ª©c Th√†nh</strong>
                                        <span>Ch·ªß DN ‚Ä¢ 40 tu·ªïi</span>
                                    </div>
                                </div>
                            </div>
                            <div class="impact-body">
                                <div class="impact-row before">
                                    <span class="icon">‚ùå</span>
                                    <p>Kinh doanh d√≤ng ti·ªÅn l·ªõn nh∆∞ng t√†i kho·∫£n c√° nh√¢n c·ª© l·∫πt ƒë·∫πt m√£i.</p>
                                </div>
                                <div class="impact-arrow">‚¨áÔ∏è GI·∫¢I PH√ÅP: T√°ch b·∫°ch d√≤ng ti·ªÅn gi·ªØa c√¥ng ty v√† c√° nh√¢n (L·ªô
                                    tr√¨nh 90 ng√†y)</div>
                                <div class="impact-row after">
                                    <span class="icon">‚úÖ</span>
                                    <p><strong>D√≤ng ti·ªÅn d∆∞∆°ng ngay l·∫≠p t·ª©c!</strong> V·ª£ khen d·∫°o n√†y qu·∫£n l√Ω n√©t th·∫ø!
                                        üòé</p>
                                </div>
                            </div>
                        </div>

                        <!-- TESTIMONIAL 4: MINIMAL QUOTE (Ng·ªçc Lan) -->
                        <!-- TESTIMONIAL 4: IOS MESSAGE STYLE (V≈© Minh) -->
                        <div class="ios-message-card"
                            style="background: #ffffff; border-radius: 20px; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; border: 2px dashed #34c759;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div
                                    style="width: 40px; height: 40px; background: linear-gradient(135deg, #34c759, #30d158); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; font-size: 1.1rem; box-shadow: 0 2px 5px rgba(52, 199, 89, 0.3);">
                                    V</div>
                                <div>
                                    <div style="font-weight: 600; color: #1c1c1e; font-size: 0.95rem;">V≈© Minh</div>
                                    <div style="color: #8e8e93; font-size: 0.75rem;">Freelancer ‚Ä¢ 28 tu·ªïi</div>
                                </div>
                                <div style="margin-left: auto; color: #8e8e93; font-size: 0.75rem;">v·ª´a xong</div>
                            </div>
                            <div
                                style="background: #34c759; color: white; padding: 12px 18px; border-radius: 18px; border-top-left-radius: 4px; display: inline-block; font-size: 0.95rem; line-height: 1.5; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                                C·ª© t∆∞·ªüng l√†m t·ª± do th√¨ kh√¥ng c·∫ßn quy c·ªß. B√°c sƒ© ch·ªâ ra ƒëi·ªÉm ch·∫øt <strong>'Thu nh·∫≠p b·∫•p
                                    b√™nh - Chi ti√™u t√πy h·ª©ng'</strong>. √Åp d·ª•ng quy t·∫Øc 6 h≈© ph√°t d∆∞ ra ƒë∆∞·ª£c <strong>20%
                                    m·ªói th√°ng</strong> ƒë·ªÉ ƒë·∫ßu t∆∞! üöÄ
                            </div>
                        </div>

                    </div>
                </section>
                <hr class="divider">

                <!-- Ph·∫ßn 2: 3 Nh·∫≠n ƒë·ªãnh chi ti·∫øt (ƒê∆∞·ª£c c·∫≠p nh·∫≠t b·ªüi JS) -->
                <div class="findings-section" id="findings-section" style="display:none;">
                    <h3>Chi ti·∫øt s·ª©c kh·ªèe t√†i ch√≠nh</h3>

                    <div class="finding-item">
                        <div class="finding-icon icon-heart">‚ô•</div>
                        <div class="finding-text" style="width: 100%;">
                            <div style="display: flex; flex-direction: column; width: 100%;">
                                <div>
                                    <strong>Nh·ªãp tim (Chi ti√™u & D√≤ng ti·ªÅn): <span id="find-spending-status"
                                            class="status-ok">---</span></strong>
                                    <p id="find-spending-desc" style="margin-bottom: 8px;">ƒêang ph√¢n t√≠ch...</p>
                                </div>
                                <div class="mini-chart-wrapper"
                                    style="width: 100%; max-width: 500px; height: 300px; margin-top: 10px;">
                                    <canvas id="spendingChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="finding-item">
                        <div class="finding-icon icon-bolt">‚ö°</div>
                        <div class="finding-text" style="width: 100%;">
                            <div style="display: flex; flex-direction: column; width: 100%;">
                                <div>
                                    <strong>NƒÉng l∆∞·ª£ng (Thu nh·∫≠p): <span id="find-income-status"
                                            class="status-ok">---</span></strong>
                                    <p id="find-income-desc" style="margin-bottom: 8px;">ƒêang ph√¢n t√≠ch...</p>
                                </div>
                                <div class="mini-chart-wrapper"
                                    style="width: 100%; max-width: 500px; height: 300px; margin-top: 10px;">
                                    <canvas id="incomeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="finding-item">
                        <div class="finding-icon icon-shield">üõ°</div>
                        <div class="finding-text" style="width: 100%;">
                            <div style="display: flex; flex-direction: column; width: 100%;">
                                <div>
                                    <strong>S·ª©c ƒë·ªÅ kh√°ng (T√†i s·∫£n): <span id="find-asset-status"
                                            class="status-warning">---</span></strong>
                                    <p id="find-asset-desc" style="margin-bottom: 8px;">ƒêang ph√¢n t√≠ch...</p>
                                </div>
                                <div class="mini-chart-wrapper"
                                    style="width: 100%; max-width: 500px; height: 300px; margin-top: 10px;">
                                    <canvas id="assetChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="finding-item">
                        <div class="finding-icon icon-blood">ü©∏</div>
                        <div class="finding-text" style="width: 100%;">
                            <div style="display: flex; flex-direction: column; width: 100%;">
                                <div>
                                    <strong>Huy·∫øt √°p (N·ª£): <span id="find-debt-status"
                                            class="status-danger">---</span></strong>
                                    <p id="find-debt-desc" style="margin-bottom: 8px;">ƒêang ph√¢n t√≠ch...</p>
                                </div>
                                <div class="mini-chart-wrapper"
                                    style="width: 100%; max-width: 500px; height: 300px; margin-top: 10px;">
                                    <canvas id="debtChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Ph·∫ßn 3: G·ª£i √Ω toa thu·ªëc -->
                <!-- Ph·∫ßn 3: M·ª•c ti√™u ti·∫øp theo -->
                <div id="next-level-content" class="prescription-section" style="display: none;">
                    <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·ªüi JS -->
                </div>


        </section>

        <!-- CTA Ti·∫øp theo -->
        <!-- CTA Ti·∫øp theo (ƒê√£ t·ªëi ∆∞u) -->


        <!-- FEATURE COMPARISON SECTION -->
        <div class="comparison-section" style="margin-bottom: 50px; padding: 0 10px;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h3 style="font-size: 1.8rem; font-weight: 800; color: #1e293b; margin-bottom: 10px;">
                    T·∫°i sao b·∫°n n√™n s·ªü h·ªØu <span style="color: #0d9488;">B·∫£n B√°o C√°o Chuy√™n S√¢u?</span>
                </h3>
                <p style="color: #64748b; max-width: 600px; margin: 0 auto;">
                    S·ª± kh√°c bi·ªát gi·ªØa vi·ªác "bi·∫øt" v√† "th·ª±c s·ª± thay ƒë·ªïi" n·∫±m ·ªü chi ti·∫øt.
                </p>
            </div>

            <div class="comparison-grid"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px; margin: 0 auto;">

                <!-- Free Card -->
                <div class="comp-card free"
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 16px; padding: 30px; position: relative;">
                    <div
                        style="background: #94a3b8; color: white; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-bottom: 15px;">
                        C∆† B·∫¢N</div>
                    <h4 style="font-size: 1.4rem; color: #334155; margin-bottom: 5px;">B√°o C√°o Mi·ªÖn Ph√≠</h4>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 25px;">ƒê·ªß ƒë·ªÉ bi·∫øt b·∫°n ƒëang ·ªü ƒë√¢u.</p>
                    <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                            <span style="color: #94a3b8;">‚úì</span> ƒêi·ªÉm s·ªë s·ª©c kh·ªèe t√†i ch√≠nh t·ªïng quan
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                            <span style="color: #94a3b8;">‚úì</span> X√°c ƒë·ªãnh C·∫•p ƒë·ªô t√†i ch√≠nh hi·ªán t·∫°i
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                            <span style="color: #94a3b8;">‚úì</span> Li·ªát k√™ c√°c ƒëi·ªÉm ngh·∫Ωn ch√≠nh
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #cbd5e1; text-decoration: line-through;">
                            <span style="color: #cbd5e1;">‚úï</span> Ph√¢n t√≠ch ƒêi·ªÉm m·∫°nh - ƒêi·ªÉm y·∫øu
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #cbd5e1; text-decoration: line-through;">
                            <span style="color: #cbd5e1;">‚úï</span> L·ªô tr√¨nh h√†nh ƒë·ªông 90 ng√†y c√° nh√¢n h√≥a
                        </li>
                    </ul>
                </div>

                <!-- Premium Card -->
                <div class="comp-card premium"
                    style="background: white; border: 2px solid #0d9488; border-radius: 16px; padding: 30px; position: relative; box-shadow: 0 10px 40px -10px rgba(13, 148, 136, 0.2); overflow: hidden;">
                    <!-- Label -->
                    <div
                        style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #0d9488, #2dd4bf); color: white; padding: 6px 15px; border-bottom-left-radius: 16px; font-weight: 700; font-size: 0.8rem;">
                        KHUY√äN D√ôNG</div>

                    <div
                        style="background: linear-gradient(135deg, #0d9488, #2dd4bf); color: white; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-bottom: 15px;">
                        CHUY√äN S√ÇU</div>
                    <h4 style="font-size: 1.4rem; color: #1e293b; margin-bottom: 5px;">B√°o C√°o Full</h4>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 25px;">Gi·∫£i ph√°p tr·ªçn g√≥i ƒë·ªÉ thay ƒë·ªïi.
                    </p>

                    <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155; font-weight: 500;">
                            <span style="color: #0d9488; font-weight: 800;">‚úì</span> Bao g·ªìm t·∫•t c·∫£ t√≠nh nƒÉng Mi·ªÖn ph√≠
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                            <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch s√¢u 12 ch·ªâ
                                s·ªë</strong> (Bi·∫øt ch√≠nh x√°c ƒëi·ªÉm m√π t√¢m l√Ω)
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                            <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>L·ªô tr√¨nh 90 ng√†y</strong>
                            c·ª• th·ªÉ r√µ r√†ng
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                            <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch g√≥c nh√¨n t√¢m
                                l√Ω</strong>
                            h√†nh vi ti√™u d√πng
                        </li>
                        <li
                            style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                            <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch R·ªßi ro 4 h·∫°ng
                                m·ª•c</strong>
                        </li>
                    </ul>
                </div>
            </div>

            <style>
                @media (max-width: 768px) {
                    .comparison-grid {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
        </div>

        <!-- CTA Upgrade Section (Bottom Duplicate) -->
        <div class="upgrade-cta-section"
            style="position: relative; margin-top: 60px; margin-bottom: 60px; padding: 2px; border-radius: 24px; background: linear-gradient(135deg, #0d9488 0%, #3b82f6 50%, #8b5cf6 100%); box-shadow: 0 20px 50px -10px rgba(15, 23, 42, 0.3);">

            <div
                style="background: #0f172a; border-radius: 22px; padding: 50px 30px; text-align: center; position: relative; overflow: hidden;">

                <!-- Glow Effect -->
                <div
                    style="position: absolute; top: -100px; left: 50%; transform: translateX(-50%); width: 400px; height: 400px; background: radial-gradient(circle, rgba(13, 148, 136, 0.15) 0%, transparent 70%); pointer-events: none;">
                </div>

                <!-- Badge -->
                <div style="margin-bottom: 25px;">
                    <span
                        style="display: inline-flex; align-items: center; gap: 6px; background: rgba(13, 148, 136, 0.15); color: #2dd4bf; padding: 8px 18px; border-radius: 30px; font-weight: 700; font-size: 0.85rem; border: 1px solid rgba(45, 212, 191, 0.3); text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 20px rgba(45, 212, 191, 0.15);">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                        </svg>
                        ∆Øu ƒë√£i gi·ªõi h·∫°n
                    </span>
                </div>

                <!-- Title -->
                <h3
                    style="font-size: 2.2rem; font-weight: 800; color: #f8fafc; margin-bottom: 15px; line-height: 1.25;">
                    M·ªü kh√≥a <span
                        style="background: linear-gradient(to right, #2dd4bf, #60a5fa); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">B√°o
                        C√°o Chuy√™n S√¢u</span><br>& Checklist h√†nh ƒë·ªông
                </h3>

                <!-- Description -->
                <p style="color: #94a3b8; font-size: 1.1rem; line-height: 1.6; max-width: 600px; margin: 0 auto 35px;">
                    Nh·∫≠n ngay b·∫£n ph√¢n t√≠ch chi ti·∫øt <strong style="color: #fff;">20+ trang</strong>, bi·ªÉu ƒë·ªì chuy√™n s√¢u
                    v√† checklist h√†nh ƒë·ªông c√° nh√¢n h√≥a d√†nh ri√™ng cho b·∫°n.
                </p>

                <!-- Price Section -->
                <div style="margin-bottom: 40px; position: relative;">
                    <div style="display: flex; align-items: baseline; justify-content: center; gap: 15px;">
                        <span
                            style="font-size: 4rem; font-weight: 800; color: #ffffff; line-height: 1; text-shadow: 0 0 40px rgba(45, 212, 191, 0.2); letter-spacing: -1px; display: inline-block; animation: price-pulse 1.5s infinite;">199.000ƒë</span>
                        <div style="text-align: left;">
                            <span
                                style="display: block; font-size: 1.2rem; color: #64748b; text-decoration: line-through; font-weight: 500;">999.000ƒë</span>
                        </div>
                    </div>
                    <!-- Savings Badge -->
                    <div style="position: absolute; top: -10px; right: 50%; transform: translateX(110px);">
                        <span
                            style="background: #f43f5e; color: white; font-size: 0.75rem; font-weight: 800; padding: 4px 8px; border-radius: 6px; transform: rotate(10deg); display: inline-block; animation: blink-badge 1.5s infinite;">TI·∫æT
                            KI·ªÜM 80%</span>
                    </div>
                </div>

                <!-- Button -->
                <button onclick="openPaymentModal()"
                    style="background: linear-gradient(to right, #0d9488, #0891b2); color: white; border: none; padding: 20px 45px; font-size: 1.25rem; font-weight: 700; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.4); display: inline-flex; align-items: center; gap: 12px; width: 100%; max-width: 380px; justify-content: center; position: relative; overflow: hidden; transform: translateY(0); animation: button-pulse 1.5s infinite;">
                    <span style="position: relative; z-index: 1;">M·ªü kh√≥a ngay</span>
                    <svg style="position: relative; z-index: 1;" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                </button>

                <!-- JS for hover effect (Handles ALL buttons) -->
                <script>
                    document.querySelectorAll('.upgrade-cta-section button').forEach(btn => {
                        btn.onmouseover = function () {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = '0 15px 35px -5px rgba(13, 148, 136, 0.6)';
                        };
                        btn.onmouseout = function () {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = '0 10px 30px -5px rgba(13, 148, 136, 0.4)';
                        };
                    });
                </script>

                <!-- Trust Badges -->
                <div
                    style="margin-top: 30px; display: flex; align-items: center; justify-content: center; gap: 25px; flex-wrap: wrap;">
                    <span
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #64748b; font-weight: 500;">
                        <div style="background: rgba(255,255,255,0.05); padding: 5px; border-radius: 50%;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#2dd4bf"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                        </div>
                        Thanh to√°n an to√†n
                    </span>
                    <span
                        style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #64748b; font-weight: 500;">
                        <div style="background: rgba(255,255,255,0.05); padding: 5px; border-radius: 50%;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#2dd4bf"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        Nh·∫≠n k·∫øt qu·∫£ trong v√≤ng 24h
                    </span>
                </div>
            </div>
        </div>

        <!-- COACHING CTA -->
        <div class="coaching-cta-section" style="margin-top: 40px; margin-bottom: 60px;">
            <div
                style="background: #e6fffa; border: 1px solid #b2f5ea; border-radius: 20px; padding: 40px 30px; text-align: center; max-width: 800px; margin: 0 auto; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);">
                <h3
                    style="color: #2c7a7b; margin-top: 0; text-transform: uppercase; font-size: 1.2rem; margin-bottom: 15px;">
                    D·ªãch v·ª• T∆∞ v·∫•n - Coaching 1:1</h3>
                <p style="color: #2d3748; margin-bottom: 30px; font-size: 1.05rem; line-height: 1.6;">"N·∫øu b·∫°n c·∫ßn d·ªãch
                    v·ª• cao c·∫•p h∆°n, c·∫ßn ng∆∞·ªùi
                    c√πng ƒë·ªìng h√†nh ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, h√£y ƒë·∫∑t l·ªãch 30 ph√∫t t∆∞ v·∫•n ƒë·ªãnh h∆∞·ªõng chuy√™n s√¢u v·ªõi Tu·∫•n ƒê·∫ßu
                    T∆∞."</p>
                <a href="https://forms.gle/RsDHGe153yC363LNA" target="_blank"
                    style="display: inline-block; background: linear-gradient(135deg, #319795 0%, #2c7a7b 100%); color: white; padding: 15px 35px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 1rem; box-shadow: 0 4px 15px rgba(49, 151, 149, 0.4); transition: transform 0.2s;">ƒêƒÇNG
                    K√ù T∆Ø V·∫§N NGAY</a>
            </div>
        </div>

    </main>

    <script>
        // C·∫•u h√¨nh Chart.js render ƒë·ªô ph√¢n gi·∫£i cao cho xu·∫•t ·∫£nh (Email/PDF)
        Chart.defaults.devicePixelRatio = 3;

        // C·∫≠p nh·∫≠t ng√†y hi·ªán t·∫°i
        const today = new Date();
        const dd = String(today.getDate()).padStart(2, '0');
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
        const yyyy = today.getFullYear();
        document.getElementById('date-display').innerText = `${dd}/${mm}/${yyyy}`;

        // L·∫•y ƒëi·ªÉm t·ª´ URL
        const urlParams = new URLSearchParams(window.location.search);
        // D·ªØ li·ªáu trung b√¨nh c·ªë ƒë·ªãnh cho 12 kh√≠a c·∫°nh: [3, 4, 3, 5, 4, 5, 4, 3, 4, 3, 5, 4]
        // [Chi ph√≠ 1-3], [Thu nh·∫≠p 4-6], [T√†i s·∫£n 7-9], [N·ª£ 10-12]
        const CONST_AVG_DATA = [4, 3, 5, 4, 5, 4, 3, 4, 5, 4, 3, 4];

        const score = parseInt(urlParams.get('score')) || 55; // M·∫∑c ƒë·ªãnh 55 n·∫øu kh√¥ng c√≥ params

        // Hi·ªÉn th·ªã ƒëi·ªÉm (ƒê√£ ·∫©n)
        // document.getElementById('score-val').innerText = `${score}/100`;

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u c·∫•p ƒë·ªô (d√πng cho vi·ªác hi·ªÉn th·ªã n·ªôi dung sau n√†y n·∫øu c·∫ßn)
        let currentLevel = 1;

        // T√≠nh v√† hi·ªÉn th·ªã ƒêi·ªÉm c·∫•p ƒë·ªô t·ªïng qu√°t
        const detailsParam = urlParams.get('details');
        if (detailsParam) {
            const detailData = detailsParam.split(',').map(Number);

            // --- H√ÄM T√çNH ƒêI·ªÇM H·∫†NG M·ª§C (Effective Score) ---
            const calculateEffectiveScore = (indices) => {
                const mScore = detailData[indices[0]] || 0;
                const s1Score = detailData[indices[1]] || 0;
                const s2Score = detailData[indices[2]] || 0;

                let modifier = 0;
                if (s1Score > mScore) modifier++;
                else if (s1Score < mScore) modifier--;
                if (s2Score > mScore) modifier++;
                else if (s2Score < mScore) modifier--;

                let effectiveScore = mScore;
                if (modifier === 2) effectiveScore += 0.6;
                else if (modifier === 1) effectiveScore += 0.3;
                else if (modifier === -1) effectiveScore -= 0.3;
                else if (modifier === -2) effectiveScore -= 0.6;

                // Return object with score and raw logic for debugging/charts
                return {
                    score: effectiveScore,
                    raw: mScore,
                    s1: s1Score,
                    s2: s2Score
                };
            };

            // 1. T√≠nh 4 ƒëi·ªÉm h·∫°ng m·ª•c
            const costES = calculateEffectiveScore([0, 1, 2]);   // Chi ph√≠ (MAIN)
            const incomeES = calculateEffectiveScore([3, 4, 5]); // Thu nh·∫≠p
            const assetES = calculateEffectiveScore([6, 7, 8]);  // T√†i s·∫£n
            const debtES = calculateEffectiveScore([9, 10, 11]); // N·ª£

            // 2. Logic so s√°nh ƒêi·ªÉm ph·ª• vs ƒêi·ªÉm ch√≠nh (Cost)
            // Rule:
            // - Cost l√† Main.
            // - M·ªói ƒëi·ªÉm ph·ª• > Main -> +1 ƒëi·ªÉm c·ªông.
            // - M·ªói ƒëi·ªÉm ph·ª• < Main -> +1 ƒëi·ªÉm tr·ª´.

            const mainScore = costES.score;
            let plusCount = 0;
            let minusCount = 0;

            const others = [incomeES.score, assetES.score, debtES.score];
            others.forEach(s => {
                if (s > mainScore) plusCount++;
                if (s < mainScore) minusCount++;
            });

            // 3. T√≠nh ƒëi·ªÉm t·ªïng cu·ªëi c√πng (Final Score)
            let finalScore = mainScore;
            let finalsuffix = "";

            // √Åp d·ª•ng quy t·∫Øc t·ª´ ·∫£nh y√™u c·∫ßu
            if (plusCount === 3) {
                finalScore += 0.6; // ++
                finalsuffix = "++";
            } else if (minusCount === 3) {
                finalScore -= 0.6; // --
                finalsuffix = "--";
            } else if (plusCount === 1 && minusCount === 2) {
                finalScore -= 0.3; // -
                finalsuffix = "-";
            } else if (minusCount === 1 && plusCount === 2) {
                finalScore += 0.3; // + (assuming '2 ƒëi·ªÉm ++' meant 2 pluses)
                finalsuffix = "+";
            } else {
                // C√°c tr∆∞·ªùng h·ª£p c√≤n l·∫°i (Equal, ho·∫∑c 2-0, 0-2...)
                // √Åp d·ª•ng logic Net Amount an to√†n:
                const net = plusCount - minusCount;
                if (net >= 2) {
                    finalScore += 0.3; finalsuffix = "+";
                } else if (net <= -2) {
                    finalScore -= 0.3; finalsuffix = "-";
                }
            }

            // L√†m tr√≤n ƒë·ªÉ x√°c ƒë·ªãnh C·∫•p ƒë·ªô (1-7)
            currentLevel = Math.round(finalScore);
            if (currentLevel < 1) currentLevel = 1;
            if (currentLevel > 7) currentLevel = 7;

            // Debug log
            console.log("Scores:", { cost: costES.score, income: incomeES.score, asset: assetES.score, debt: debtES.score });
            console.log("Counts:", { plus: plusCount, minus: minusCount });
            console.log("Final:", finalScore, "-> Level:", currentLevel);

            // C·∫≠p nh·∫≠t text hi·ªÉn th·ªã s·ªë c·∫•p ƒë·ªô
            const levelValParams = document.getElementById('level-val');
            if (levelValParams) {
                // Hi·ªÉn th·ªã ƒëi·ªÉm t·ªïng cu·ªëi c√πng (Decimal) k√®m th√¥ng tin c·∫•p ƒë·ªô g·∫ßn nh·∫•t
                // Hi·ªÉn th·ªã ƒëi·ªÉm t·ªïng cu·ªëi c√πng (Decimal) k√®m th√¥ng tin c·∫•p ƒë·ªô g·∫ßn nh·∫•t v√† Tooltip
                levelValParams.innerHTML = `
                    <div class="tooltip-wrap" style="display: inline-block; position: relative; cursor: help; vertical-align: middle;">
                        <span style="color: #006d75; font-size: 1.1rem; margin-right: 4px;">‚ìò</span>
                        <div class="tooltip-content" style="display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); width: 280px; background: #264653; color: #fff; padding: 12px; border-radius: 8px; font-size: 0.85rem; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.15); margin-bottom: 10px; line-height: 1.4; font-weight: normal; text-align: left;">
                            ƒêi·ªÉm ƒë∆∞·ª£c t√≠nh to√°n d·ª±a tr√™n m√¥ h√¨nh t√†i ch√≠nh nh√¢n qu·∫£ 347 c·ªßa <a href="https://www.facebook.com/TuanDauTu68/" target="_blank" style="color: #4CC9F0; text-decoration: underline;">Tu·∫•n ƒê·∫ßu T∆∞</a>.
                            <div style="position: absolute; top: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: #264653 transparent transparent transparent;"></div>
                        </div>
                        <style>
                            .tooltip-wrap:hover .tooltip-content { display: block !important; }
                        </style>
                    </div> ${finalScore.toFixed(1)}/7 (C·∫•p ƒë·ªô ${currentLevel})`;
            }

            // C·∫≠p nh·∫≠t v·ªã tr√≠ m≈©i t√™n tr√™n th√°p
            const pyramidWrapper = document.querySelector('.pyramid-wrapper');
            if (pyramidWrapper) {
                // X√≥a m≈©i t√™n c≈© n·∫øu c√≥ 
                const oldIndicator = pyramidWrapper.querySelector('.current-level-indicator');
                if (oldIndicator) oldIndicator.remove();

                const indicator = document.createElement('div');
                indicator.className = 'current-level-indicator';
                indicator.innerHTML = '<span>B·∫°n ·ªü ƒë√¢y</span> üëâ';

                pyramidWrapper.appendChild(indicator);

                // T√¨m element level t∆∞∆°ng ·ª©ng
                const targetLevel = pyramidWrapper.querySelector(`.level-${currentLevel}`);
                const targetAvgLevel = pyramidWrapper.querySelector(`.level-4`); // Trung b√¨nh l√† c·∫•p 4

                if (targetLevel) {
                    // S·ª≠ d·ª•ng requestAnimationFrame ƒë·ªÉ ƒë·∫£m b·∫£o layout ƒë√£ render xong
                    requestAnimationFrame(() => {
                        const wrapperRect = pyramidWrapper.getBoundingClientRect();
                        const targetRect = targetLevel.getBoundingClientRect();

                        // T√≠nh to√°n v·ªã tr√≠ "B·∫°n ·ªü ƒë√¢y" (Tr√°i)
                        const topPos = targetRect.top - wrapperRect.top + (targetRect.height / 2);
                        const leftPos = targetRect.left - wrapperRect.left;

                        indicator.style.top = `${topPos}px`;
                        indicator.style.left = `${leftPos}px`;

                        // --- INDICATOR TRUNG B√åNH (B√äN PH·∫¢I) ---
                        if (targetAvgLevel) {
                            // X√≥a c≈© n·∫øu c√≥
                            const oldAvgAndicator = pyramidWrapper.querySelector('.avg-level-indicator');
                            if (oldAvgAndicator) oldAvgAndicator.remove();

                            const avgIndicator = document.createElement('div');
                            avgIndicator.className = 'avg-level-indicator';
                            avgIndicator.style.position = 'absolute';
                            avgIndicator.style.display = 'flex';
                            avgIndicator.style.alignItems = 'center';
                            avgIndicator.style.transform = 'translateY(-50%)';
                            avgIndicator.style.zIndex = '10';

                            avgIndicator.innerHTML = 'üëà <span style="background: #fff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-left: 5px; color: #555;">Trung b√¨nh ng∆∞·ªùi test kh√°c</span>';

                            pyramidWrapper.appendChild(avgIndicator);

                            const avgRect = targetAvgLevel.getBoundingClientRect();
                            const avgTop = avgRect.top - wrapperRect.top + (avgRect.height / 2);
                            const avgLeft = avgRect.right - wrapperRect.left + 10;

                            avgIndicator.style.top = `${avgTop}px`;
                            avgIndicator.style.left = `${avgLeft}px`;
                        }
                    });
                }
            }


            // --- Hi·ªÉn th·ªã n·ªôi dung chi ti·∫øt C·∫•p ƒë·ªô (Ch·∫©n ƒëo√°n & Bi·ªÉu hi·ªán) ---
            if (typeof FINANCIAL_LEVELS_DATA !== 'undefined' && FINANCIAL_LEVELS_DATA[currentLevel]) {
                const levelData = FINANCIAL_LEVELS_DATA[currentLevel];
                const diagContainer = document.getElementById('level-diagnosis-content');

                if (diagContainer) {
                    // L·∫•y 2 section ƒë·∫ßu ti√™n: Ch·∫©n ƒëo√°n (index 0) v√† Bi·ªÉu hi·ªán (index 1)
                    const section1 = levelData.content[0]; // Ch·∫©n ƒêo√°n
                    const section2 = levelData.content[1]; // Bi·ªÉu hi·ªán

                    let htmlContent = `
                        <div class="level-detail-card" style="background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #ebebeb; margin-bottom: 20px;">
                            <div class="level-header" style="background: ${levelData.color}; padding: 24px; color: #fff; position: relative; overflow: hidden;">
                                <div style="position: relative; z-index: 2;">
                                    <h3 style="margin: 0; font-size: 1.6rem; font-weight: 800; letter-spacing: -0.5px;">C·∫§P ƒê·ªò ${currentLevel}: ${levelData.title.toUpperCase()}</h3>
                                    <p style="margin: 6px 0 0; opacity: 0.95; font-size: 1.05rem; font-weight: 500;">${levelData.subtitle}</p>
                                </div>
                                <div style="position: absolute; top: -20px; right: -20px; font-size: 8rem; opacity: 0.15; transform: rotate(15deg); z-index: 1;">
                                    ${currentLevel}
                                </div>
                            </div>
                            
                            <div class="level-body" style="padding: 24px;">
                                <style>
                                    .level-body ul { padding-left: 20px; margin-top: 12px; margin-bottom: 20px; }
                                    .level-body li { margin-bottom: 8px; position: relative; list-style-type: none; padding-left: 10px; }
                                    .level-body li::before { content: "‚Ä¢"; color: ${levelData.color}; font-weight: bold; position: absolute; left: -15px; font-size: 1.4em; top: -4px; }
                                    .level-body p { margin-bottom: 12px; }
                                    /* Highlight first paragraph */
                                    .diagnosis-section > div > p:first-child, .signs-section > div > p:first-child { 
                                        font-size: 1.05rem; 
                                        font-weight: 600; 
                                        color: #2d3748;
                                        line-height: 1.6;
                                    }
                                    .level-body strong { color: #1a202c; font-weight: 700; }
                                </style>
                                
                                <div class="diagnosis-section" style="margin-bottom: 32px;">
                                    <div class="section-title" style="display: flex; align-items: center; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                                        <span style="font-size: 1.2rem; margin-right: 12px; background: #f0f4f8; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">ü©∫</span>
                                        <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1a202c; text-transform: uppercase; letter-spacing: 0.5px;">${section1.heading}</h4>
                                    </div>
                                    <div style="font-size: 0.95rem; color: #4a5568; line-height: 1.7; text-align: justify;">${section1.body}</div>
                                </div>

                                <div class="signs-section">
                                    <div class="section-title" style="display: flex; align-items: center; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                                        <span style="font-size: 1.2rem; margin-right: 12px; background: #fff8e1; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">üëÅÔ∏è</span>
                                        <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1a202c; text-transform: uppercase; letter-spacing: 0.5px;">${section2.heading}</h4>
                                    </div>
                                    <div style="font-size: 0.95rem; color: #4a5568; line-height: 1.7; text-align: justify;">${section2.body}</div>
                                </div>

                                    <div class="warning-section" style="margin-top: 32px; padding-top: 24px; border-top: 1px dashed #e2e8f0;">
                                        <div class="section-title" style="display: flex; align-items: center; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                                            <span style="font-size: 1.2rem; margin-right: 12px; background: #fee2e2; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">‚ö†Ô∏è</span>
                                            <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #991b1b; text-transform: uppercase; letter-spacing: 0.5px;">3. N·∫æU B·∫†N KH√îNG THAY ƒê·ªîI...</h4>
                                        </div>
                                        <div style="font-size: 0.95rem; color: #4a5568; line-height: 1.7; text-align: justify;">${(levelData.content.find(c => c.heading.includes("N·∫øu B·∫°n Kh√¥ng Thay ƒê·ªïi")) || levelData.content[4] || {}).body || ''}</div>
                                    </div>
                            </div>
                        </div>
                    `;

                    diagContainer.innerHTML = htmlContent;
                    document.getElementById('level-diagnosis-wrapper').style.display = 'block';

                    // --- Hi·ªÉn th·ªã M·ª•c ti√™u ti·∫øp theo (N·ªôi dung 6 & 7 t·ª´ levels_data) ---
                    // --- Hi·ªÉn th·ªã M·ª•c ti√™u ti·∫øp theo (N·ªôi dung 7 t·ª´ levels_data) ---
                    // ƒê√£ b·ªè ph·∫ßn "∆Øu ti√™n 90 ng√†y" (content[5]) theo y√™u c·∫ßu

                    const nextLevelContainer = document.getElementById('next-level-content');
                    if (nextLevelContainer) {
                        let htmlNext = '';

                        // --- X·ª≠ l√Ω Section 7: L·ªùi nh·∫Øn B√°c sƒ© ---
                        if (levelData.content[6]) {
                            const sectionAction = levelData.content[6];
                            const cleanActionHeading = sectionAction.heading.replace(/^\d+\.\s*/, '');

                            htmlNext += `
                                <div class="doctor-letter-card" style="background: #f0f9ff; border-left: 5px solid #3182ce; border-radius: 8px; padding: 24px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                        <span style="font-size: 1.5rem; margin-right: 12px;">ü©∫</span>
                                        <h4 style="margin: 0; color: #2b6cb0; font-size: 1.2rem; font-weight: 700;">${cleanActionHeading}</h4>
                                    </div>
                                    <div style="font-family: 'Lora', 'Merriweather', serif; font-size: 1rem; color: #2d3748; line-height: 1.8;">
                                        ${sectionAction.body}
                                    </div>
                                </div>
                             `;
                        }

                        if (htmlNext) {
                            nextLevelContainer.innerHTML = htmlNext;
                            nextLevelContainer.style.display = 'block';
                        } else {
                            nextLevelContainer.style.display = 'none';
                        }
                    }
                }
            }
        }

        // Logic hi·ªÉn th·ªã l·ªùi nh·∫Øn t·ª´ b√°c sƒ© d·ª±a tr√™n C·∫•p ƒë·ªô (currentLevel)
        const doctorMsg = document.getElementById('doctor-msg');

        // B·ªô l·ªùi nh·∫Øn "k√™ ƒë∆°n" theo t·ª´ng c·∫•p ƒë·ªô
        const doctorAdvice = {
            1: "T√¥i ƒë√°nh gi√° cao s·ª± d≈©ng c·∫£m c·ªßa b·∫°n khi d√°m nh√¨n th·∫≥ng s·ª± th·∫≠t. Hi·ªán t·∫°i, v√≠ ti·ªÅn ƒëang ki·ªát s·ª©c v√† g·ª≠i t√≠n hi·ªáu SOS. ƒê·ª´ng lo, ch·ªâ c·∫ßn 's∆° c·ª©u' d√≤ng ti·ªÅn ngay l√∫c n√†y, b·∫°n s·∫Ω s·ªõm h·ªìi ph·ª•c ƒë·ªÉ v∆∞∆°n l√™n c·∫•p ƒë·ªô Sinh T·ªìn.",
            2: "T√¥i ghi nh·∫≠n s·ª± n·ªó l·ª±c b·ªÅn b·ªâ c·ªßa b·∫°n m·ªói ng√†y. S·ª± m·ªát m·ªèi hi·ªán t·∫°i ch·ªâ l√† do thi·∫øu m·ªôt l·ªõp ƒë·ªám d·ª± ph√≤ng nh·ªè m√† th√¥i. H√£y t√≠ch l≈©y ngay Qu·ªπ Kh·∫©n C·∫•p, ƒë√≥ l√† li·ªÅu thu·ªëc an th·∫ßn gi√∫p b·∫°n v·ªØng tin b∆∞·ªõc l√™n c·∫•p ƒë·ªô An To√†n.",
            3: "Ch√∫c m·ª´ng b·∫°n ƒë√£ xu·∫•t s·∫Øc tho√°t kh·ªèi v√πng nguy hi·ªÉm! N·ªÅn t·∫£ng c·ªßa b·∫°n ƒë√£ kh√° ·ªïn, nh∆∞ng c·∫ßn th√™m s·ª©c b·∫≠t ƒë·ªÉ ƒëi xa h∆°n. H√£y x√¢y d·ª±ng k·ª∑ lu·∫≠t ƒë·∫ßu t∆∞ ngay b√¢y gi·ªù, c√°nh c·ª≠a c·∫•p ƒë·ªô ·ªîn ƒê·ªãnh ƒëang ch·ªù ƒë√≥n b·∫°n.",
            4: "K·∫øt qu·∫£ r·∫•t kh·∫£ quan! B·∫°n ƒëang c√≥ s·ª± ·ªïn ƒë·ªãnh m√† nhi·ªÅu ng∆∞·ªùi m∆° ∆∞·ªõc. Tuy nhi√™n, 'an to√†n qu√°' ƒë√¥i khi l·∫°i k√¨m h√£m s·ª± b·ª©t ph√°. H√£y h·ªçc c√°ch b·∫Øt ti·ªÅn l√†m vi·ªác v·∫•t v·∫£ h∆°n ƒë·ªÉ b·∫°n th·∫£nh th∆°i ti·∫øn l√™n c·∫•p ƒë·ªô V·ªØng V√†ng.",
            5: "R·∫•t ·∫•n t∆∞·ª£ng! S·ª©c kh·ªèe t√†i ch√≠nh c·ªßa b·∫°n ƒëang c∆∞·ªùng tr√°ng. Nh∆∞ng ƒë·ª´ng ng·ªß qu√™n tr√™n chi·∫øn th·∫Øng, h√£y t·ªëi ∆∞u h√≥a danh m·ª•c ƒë·∫ßu t∆∞ ƒë·ªÉ t√†i s·∫£n tƒÉng t·ªëc nhanh h∆°n. C·∫•p ƒë·ªô ƒê·ªôc L·∫≠p T√†i Ch√≠nh ho√†n to√†n n·∫±m trong t·∫ßm tay b·∫°n.",
            6: "Th·∫≠t tuy·ªát v·ªùi! B·∫°n ƒë√£ ƒë·∫°t ƒë∆∞·ª£c gi·∫•c m∆° c·ªßa h√†ng tri·ªáu ng∆∞·ªùi. Tuy nhi√™n, gi·ªØ ti·ªÅn kh√≥ h∆°n ki·∫øm ti·ªÅn. H√£y x√¢y d·ª±ng h√†o l≈©y b·∫£o v·ªá t√†i s·∫£n v·ªØng ch·∫Øc ƒë·ªÉ t·ª± tin ki·∫øn t·∫°o di s·∫£n ·ªü c·∫•p ƒë·ªô T·ª± Do T√†i Ch√≠nh cao nh·∫•t.",
            7: "ƒê·ªânh cao tuy·ªát ƒë·ªëi! B·∫°n l√† minh ch·ª©ng s·ªëng cho s·ª± k·ª∑ lu·∫≠t v√† tr√≠ tu·ªá t√†i ch√≠nh. ƒê·ª´ng d·ª´ng l·∫°i ·ªü vi·ªác l√†m gi√†u cho b·∫£n th√¢n, h√£y chia s·∫ª v√† d·∫´n d·∫Øt ng∆∞·ªùi kh√°c c√πng v∆∞∆°n t·ªõi s·ª± th·ªãnh v∆∞·ª£ng. ƒê√≥ m·ªõi l√† di s·∫£n vƒ© ƒë·∫°i nh·∫•t."
        };

        // Hi·ªÉn th·ªã l·ªùi nh·∫Øn t∆∞∆°ng ·ª©ng v·ªõi c·∫•p ƒë·ªô (n·∫øu kh√¥ng c√≥ th√¨ d√πng m·∫∑c ƒë·ªãnh)
        if (doctorMsg) {
            const advice = doctorAdvice[currentLevel] || "H√£y ti·∫øp t·ª•c theo d√µi s·ª©c kh·ªèe t√†i ch√≠nh c·ªßa b·∫°n ƒë·ªãnh k·ª≥ nh√©. Ph√≤ng b·ªánh h∆°n ch·ªØa b·ªánh!";
            doctorMsg.innerHTML = `" ${advice} "`;
        }

        // V·∫Ω bi·ªÉu ƒë·ªì k·∫øt qu·∫£
        // (Bi·∫øn detailsParam ƒë√£ ƒë∆∞·ª£c khai b√°o ·ªü tr√™n)
        if (detailsParam) {
            const detailData = detailsParam.split(',').map(Number);
            // Updated Benchmark Data from User
            const CONST_AVG_DATA = [4.1, 3.9, 5.4, 4.2, 4.2, 5.8, 4.1, 3.7, 3.5, 4.3, 3.6, 5.6];
            const ctx = document.getElementById('resultChart').getContext('2d');

            // T√™n ng·∫Øn g·ªçn cho 12 tr·ª•c (gi·ªëng test.js)
            const rawLabels = [
                "T·ª∑ l·ªá Chi Ti√™u", "Qu·∫£n L√Ω CT", "C·∫£m X√∫c CT",
                "TN th·ª• ƒë·ªông", "V·ªã th·∫ø TN", "Gia tƒÉng TN",
                "TS/Chi ph√≠", "C·∫•u tr√∫c TS", "Qu·∫£n L√Ω TS",
                "T·ª∑ l·ªá N·ª¢", "M·ª•c ƒë√≠ch N·ª¢", "C·∫£m x√∫c N·ª¢"
            ];

            // X·ª≠ l√Ω Label: Th√™m icon v√† m√†u s·∫Øc
            const displayLabels = [];
            const labelColors = [];
            const fontWeights = [];

            detailData.forEach((score, index) => {
                const scoreText = `(${score})`;
                if (score <= 2) {
                    displayLabels.push(`‚ö†Ô∏è ${rawLabels[index]} ${scoreText}`);
                    labelColors.push('#E63946'); // ƒê·ªè
                    fontWeights.push('bold');
                } else if (score >= 6) {
                    displayLabels.push(`üåü ${rawLabels[index]} ${scoreText}`);
                    labelColors.push('#2A9D8F'); // Xanh
                    fontWeights.push('bold');
                } else {
                    displayLabels.push(`${rawLabels[index]} ${scoreText}`);
                    labelColors.push('#2D3748'); // M·∫∑c ƒë·ªãnh
                    fontWeights.push('normal');
                }
            });

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: displayLabels,
                    datasets: [{
                        label: 'K·∫øt qu·∫£ c·ªßa b·∫°n',
                        data: detailData,
                        backgroundColor: 'rgba(44, 110, 115, 0.2)',
                        borderColor: '#2C6E73',
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#D4A373',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#D4A373',
                        borderWidth: 3
                    },
                    {
                        label: 'Trung b√¨nh ng∆∞·ªùi test kh√°c',
                        data: CONST_AVG_DATA,
                        backgroundColor: 'transparent',
                        borderColor: '#FF6B6B',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(0, 0, 0, 0.2)' },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' },
                            pointLabels: {
                                font: {
                                    size: 14,
                                    family: "'Be Vietnam Pro', sans-serif",
                                    weight: (context) => fontWeights[context.index]
                                },
                                color: labelColors // M·∫£ng m√†u s·∫Øc t∆∞∆°ng ·ª©ng
                            },
                            suggestedMin: 0,
                            suggestedMax: 7,
                            ticks: { display: false, stepSize: 1 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // X·ª≠ l√Ω hi·ªÉn th·ªã Kh√≠a c·∫°nh c·∫ßn theo d√µi/ph√°t huy
            const weakList = document.getElementById('weak-list');
            const strongList = document.getElementById('strong-list');
            const aspectsContainer = document.getElementById('aspects-analysis');
            const weakGroup = document.getElementById('weak-group');
            const strongGroup = document.getElementById('strong-group');

            let hasWeak = false;
            let hasStrong = false;

            detailData.forEach((score, index) => {
                if (score <= 2) {
                    hasWeak = true;
                    weakList.innerHTML += `<li style="margin-bottom: 4px;"><strong>${rawLabels[index]}</strong> (C·∫•p ${score})</li>`;
                } else if (score >= 6) {
                    hasStrong = true;
                    strongList.innerHTML += `<li style="margin-bottom: 4px;"><strong>${rawLabels[index]}</strong> (C·∫•p ${score})</li>`;
                }
            });

            // Lu√¥n hi·ªÉn th·ªã container ƒë·ªÉ hi·ªán Th√°p T√†i Ch√≠nh
            aspectsContainer.style.display = 'block';

            // ·∫®n hi·ªán t·ª´ng nh√≥m
            weakGroup.style.display = hasWeak ? 'block' : 'none';
            strongGroup.style.display = hasStrong ? 'block' : 'none';

            // Tinh ch·ªânh giao di·ªán c√°c nh√≥m (Border divider)
            if (hasWeak) {
                // N·∫øu c√≥ weak nh∆∞ng kh√¥ng c√≥ strong, b·ªè border-bottom c·ªßa weak ƒëi
                weakGroup.style.borderBottom = (hasStrong) ? '1px solid #eee' : 'none';
            }
            // N·∫øu c√≥ strong, th√™m border-bottom ƒë·ªÉ ph√¢n c√°ch v·ªõi ph·∫ßn level-diagnosis
            if (hasStrong) {
                strongGroup.style.borderBottom = '1px solid #eee';
            } else if (hasWeak) {
                // N·∫øu kh√¥ng c√≥ strong nh∆∞ng c√≥ weak, weak s·∫Ω c·∫ßn border bottom ƒë·ªÉ ph√¢n c√°ch v·ªõi diagnosis
                weakGroup.style.borderBottom = '1px solid #eee';
            }


            // --- C·∫¨P NH·∫¨T CHI TI·∫æT B·ªÜNH L√ù (Findings) ---
            const findingsSec = document.getElementById('findings-section');
            findingsSec.style.display = 'block'; // Must be block for charts to render
            findingsSec.style.position = 'absolute';
            findingsSec.style.left = '-9999px'; // Move off-screen
            findingsSec.style.top = '-9999px';
            findingsSec.style.width = '600px'; // Set fixed width for charts to draw correctly

            // H√†m t√≠nh trung b√¨nh nh√≥m
            const getAvg = (indices) => {
                const s = indices.reduce((sum, i) => sum + (detailData[i] || 0), 0);
                return Math.round((s / indices.length) * 10) / 10;
            };

            // 1. Chi ti√™u (Logic ƒë·∫∑c bi·ªát: ƒêi·ªÉm ch√≠nh + ƒêi·ªÉm ph·ª•)
            // Index 0: T·ª∑ l·ªá chi ti√™u (Main - M)
            // Index 1: Qu·∫£n l√Ω CT (Sub 1)
            // Index 2: C·∫£m x√∫c CT (Sub 2)
            const mScore = detailData[0] || 0;
            const s1Score = detailData[1] || 0; // Qu·∫£n l√Ω
            const s2Score = detailData[2] || 0; // C·∫£m x√∫c

            let modifier = 0;

            // So s√°nh Sub 1 v·ªõi Main
            if (s1Score > mScore) modifier++;
            else if (s1Score < mScore) modifier--;

            // So s√°nh Sub 2 v·ªõi Main
            if (s2Score > mScore) modifier++;
            else if (s2Score < mScore) modifier--;

            // T·∫°o suffix string v√† gi√° tr·ªã th·ª±c t·∫ø ƒë·ªÉ v·∫Ω chart
            let suffix = "";
            let effectiveScore = mScore;

            if (modifier === 2) { suffix = " ++"; effectiveScore += 0.6; }
            else if (modifier === 1) { suffix = " +"; effectiveScore += 0.3; }
            else if (modifier === 0) { suffix = ""; }
            else if (modifier === -1) { suffix = " -"; effectiveScore -= 0.3; }
            else if (modifier === -2) { suffix = " --"; effectiveScore -= 0.6; }

            // Gi·ªõi h·∫°n effectiveScore trong kho·∫£ng 1-7 (n·∫øu c·∫ßn thi·∫øt, nh∆∞ng ++ c√≥ th·ªÉ v∆∞·ª£t ch√∫t c≈©ng ko sao)

            const spendStatus = document.getElementById('find-spending-status');
            const spendDesc = document.getElementById('find-spending-desc');

            // X·∫øp lo·∫°i hi·ªÉn th·ªã
            let statusClass = "status-warning";
            if (effectiveScore >= 5) statusClass = "status-ok";
            if (effectiveScore <= 2.5) statusClass = "status-danger";

            spendStatus.innerHTML = `C·∫•p ${mScore}${suffix}`;
            spendStatus.className = statusClass;

            // M√¥ t·∫£
            if (effectiveScore >= 6) {
                spendDesc.innerHTML = "Nh·ªãp tim t√†i ch√≠nh r·∫•t kh·ªèe m·∫°nh.";
            } else if (effectiveScore <= 3) {
                spendDesc.innerHTML = "Nh·ªãp tim y·∫øu ho·∫∑c r·ªëi lo·∫°n, c·∫ßn 'tr·ª£ tim' g·∫•p.";
            } else {
                spendDesc.innerHTML = "Nh·ªãp tim b√¨nh th∆∞·ªùng nh∆∞ng ch∆∞a t·ªëi ∆∞u.";
            }

            // V·∫Ω Mini Chart cho H·∫°ng m·ª•c Chi ph√≠
            // V·∫Ω Chart cho H·∫°ng m·ª•c Chi ph√≠ (Bar Chart)
            const ctxSpend = document.getElementById('spendingChart').getContext('2d');

            // Labels cho tr·ª•c Y
            const yLabels = {
                7: "T·ª± do chi ph√≠",
                6: "ƒê·ªôc l·∫≠p chi ph√≠",
                5: "V·ªØng v√†ng chi ph√≠",
                4: "·ªîn ƒë·ªãnh chi ph√≠",
                3: "An to√†n chi ph√≠",
                2: "Sinh t·ªìn chi ph√≠",
                1: "Kh·ªßng ho·∫£ng chi ph√≠",
                0: ""
            };

            // Data cho 4 c·ªôt
            const barData = [mScore, s1Score, s2Score, effectiveScore];

            // Mapping c·∫•p ƒë·ªô -> T√™n
            const levelNames = {
                1: "Kh·ªßng ho·∫£ng",
                2: "Sinh t·ªìn",
                3: "An to√†n",
                4: "·ªîn ƒë·ªãnh",
                5: "V·ªØng v√†ng",
                6: "ƒê·ªôc l·∫≠p",
                7: "T·ª± do"
            };

            // T√≠nh to√°n d·ªØ li·ªáu trung b√¨nh c·ªë ƒë·ªãnh cho Spend Chart (Index 0,1,2)
            const spendAvgSub = CONST_AVG_DATA.slice(0, 3);
            const spendAvgTotal = parseFloat((spendAvgSub.reduce((a, b) => a + b, 0) / 3).toFixed(1)); // L√†m tr√≤n 1 s·ªë th·∫≠p ph√¢n
            const spendAvgData = [...spendAvgSub, spendAvgTotal];

            new Chart(ctxSpend, {
                type: 'bar',
                data: {
                    labels: ["T·ª∑ l·ªá chi ti√™u", "Qu·∫£n l√Ω CT", "C·∫£m x√∫c CT", "ƒêi·ªÉm H·∫°ng M·ª•c"],
                    datasets: [
                        {
                            label: 'Trung b√¨nh ng∆∞·ªùi test kh√°c',
                            data: spendAvgData,
                            type: 'line',
                            borderColor: '#FF6B6B',
                            borderWidth: 2,
                            borderDash: [5, 5], // N√©t ƒë·ª©t
                            pointBackgroundColor: '#FF6B6B',
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            fill: false,
                            order: 0 // V·∫Ω l√™n tr√™n
                        },
                        {
                            label: 'C·∫•p ƒë·ªô c·ªßa b·∫°n',
                            data: [mScore, s1Score, s2Score, effectiveScore],
                            backgroundColor: [
                                'rgba(42, 157, 143, 0.6)', // Teal
                                'rgba(233, 196, 106, 0.6)', // Yellow
                                'rgba(244, 162, 97, 0.6)',  // Orange
                                'rgba(38, 70, 83, 0.9)'     // Dark Blue (Final)
                            ],
                            borderColor: [
                                '#2A9D8F',
                                '#E9C46A',
                                '#F4A261',
                                '#264653'
                            ],
                            borderWidth: 1,
                            borderRadius: 4,
                            barPercentage: 0.6,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0, max: 8,
                            ticks: {
                                stepSize: 1,
                                callback: function (value) { return levelNames[value] || ""; },
                                font: { size: 11, family: "'Be Vietnam Pro', sans-serif" }
                            },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10, family: "'Be Vietnam Pro', sans-serif" } }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    if (context.dataset.type === 'line') {
                                        return ` TB ng∆∞·ªùi test kh√°c: C·∫•p ${context.raw}`;
                                    }
                                    if (context.dataIndex === 3) {
                                        return ` K·∫øt qu·∫£: C·∫•p ${mScore}${suffix} (${levelNames[mScore]})`;
                                    }
                                    const val = Math.round(context.raw);
                                    return ` C·∫•p ${val}: ${levelNames[val] || ''}`;
                                }
                            }
                        }
                    }
                }
            });

            // H√†m d√πng chung ƒë·ªÉ t√≠nh to√°n v√† v·∫Ω chart cho t·ª´ng h·∫°ng m·ª•c
            const processCategory = (indices, labels, canvasId, statusId, descId, descTexts) => {
                const mScore = detailData[indices[0]] || 0;
                const s1Score = detailData[indices[1]] || 0;
                const s2Score = detailData[indices[2]] || 0;

                let modifier = 0;
                if (s1Score > mScore) modifier++;
                else if (s1Score < mScore) modifier--;
                if (s2Score > mScore) modifier++;
                else if (s2Score < mScore) modifier--;

                let suffix = "";
                let effectiveScore = mScore;
                if (modifier === 2) { suffix = " ++"; effectiveScore += 0.6; }
                else if (modifier === 1) { suffix = " +"; effectiveScore += 0.3; }
                else if (modifier === 0) { suffix = ""; }
                else if (modifier === -1) { suffix = " -"; effectiveScore -= 0.3; }
                else if (modifier === -2) { suffix = " --"; effectiveScore -= 0.6; }

                // T√≠nh to√°n d·ªØ li·ªáu trung b√¨nh c·ªë ƒë·ªãnh d·ª±a tr√™n indices
                const avgSub = indices.map(i => CONST_AVG_DATA[i]);
                const avgTotal = parseFloat((avgSub.reduce((a, b) => a + b, 0) / 3).toFixed(1));
                const avgData = [...avgSub, avgTotal];

                // C·∫≠p nh·∫≠t text
                const statusEl = document.getElementById(statusId);
                const descEl = document.getElementById(descId);

                let statusClass = "status-warning";
                if (effectiveScore >= 5) statusClass = "status-ok";
                if (effectiveScore <= 2.5) statusClass = "status-danger";

                statusEl.innerHTML = `C·∫•p ${mScore}${suffix}`;
                statusEl.className = statusClass;

                if (effectiveScore >= 5) descEl.innerHTML = descTexts.good;
                else if (effectiveScore <= 3) descEl.innerHTML = descTexts.bad;
                else descEl.innerHTML = descTexts.mid;

                // V·∫Ω Chart
                const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [...labels, "ƒêi·ªÉm H·∫°ng M·ª•c"],
                        datasets: [
                            {
                                label: 'Trung b√¨nh ng∆∞·ªùi test kh√°c',
                                data: avgData,
                                type: 'line',
                                borderColor: '#FF6B6B',
                                borderWidth: 2,
                                borderDash: [5, 5], // N√©t ƒë·ª©t
                                pointBackgroundColor: '#FF6B6B',
                                pointBorderColor: '#fff',
                                pointRadius: 4,
                                fill: false,
                                order: 0 // V·∫Ω l√™n tr√™n
                            },
                            {
                                label: 'C·∫•p ƒë·ªô c·ªßa b·∫°n',
                                data: [mScore, s1Score, s2Score, effectiveScore],
                                backgroundColor: [
                                    'rgba(42, 157, 143, 0.6)', 'rgba(233, 196, 106, 0.6)', 'rgba(244, 162, 97, 0.6)', 'rgba(38, 70, 83, 0.9)'
                                ],
                                borderColor: [
                                    '#2A9D8F', '#E9C46A', '#F4A261', '#264653'
                                ],
                                borderWidth: 1,
                                borderRadius: 4,
                                barPercentage: 0.6,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                min: 0, max: 8,
                                ticks: {
                                    stepSize: 1,
                                    callback: function (value) { return levelNames[value] || ""; },
                                    font: { size: 11, family: "'Be Vietnam Pro', sans-serif" }
                                },
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { font: { size: 10, family: "'Be Vietnam Pro', sans-serif" } }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    font: { size: 11 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        if (context.dataset.type === 'line') {
                                            return ` TB ng∆∞·ªùi test kh√°c: C·∫•p ${context.raw}`;
                                        }
                                        if (context.dataIndex === 3) {
                                            return ` K·∫øt qu·∫£: C·∫•p ${mScore}${suffix} (${levelNames[mScore]})`;
                                        }
                                        const val = Math.round(context.raw);
                                        return ` C·∫•p ${val}: ${levelNames[val] || ''}`;
                                    }
                                }
                            }
                        }
                    }
                });
            };

            // 2. Thu nh·∫≠p (C√¢u 4-6 -> Index 3-5)
            processCategory(
                [3, 4, 5],
                ["TN th·ª• ƒë·ªông", "V·ªã th·∫ø TN", "Gia tƒÉng TN"],
                "incomeChart", "find-income-status", "find-income-desc",
                {
                    good: "NƒÉng l∆∞·ª£ng t√†i ch√≠nh d·ªìi d√†o, ƒëa d·∫°ng ngu·ªìn thu.",
                    bad: "NƒÉng l∆∞·ª£ng y·∫øu, ph·ª• thu·ªôc v√†o m·ªôt ngu·ªìn thu duy nh·∫•t.",
                    mid: "Thu nh·∫≠p ·ªïn ƒë·ªãnh nh∆∞ng ch∆∞a c√≥ s·ª± b·ª©t ph√° m·∫°nh m·∫Ω."
                }
            );

            // 3. T√†i s·∫£n (C√¢u 7-9 -> Index 6-8)
            processCategory(
                [6, 7, 8],
                ["TS/Chi ph√≠", "C·∫•u tr√∫c TS", "Qu·∫£n L√Ω TS"],
                "assetChart", "find-asset-status", "find-asset-desc",
                {
                    good: "H·ªá mi·ªÖn d·ªãch t√†i ch√≠nh r·∫•t t·ªët, t√†i s·∫£n sinh l·ªùi t·ª± ƒë·ªông.",
                    bad: "S·ª©c ƒë·ªÅ kh√°ng y·∫øu, d·ªÖ t·ªïn th∆∞∆°ng n·∫øu g·∫∑p bi·∫øn c·ªë.",
                    mid: "ƒêang t√≠ch l≈©y nh∆∞ng t√†i s·∫£n ch∆∞a th·ª±c s·ª± t·ªëi ∆∞u."
                }
            );

            // 4. N·ª£ (C√¢u 10-12 -> Index 9-11)
            processCategory(
                [9, 10, 11],
                ["T·ª∑ l·ªá N·ª¢", "M·ª•c ƒë√≠ch N·ª¢", "C·∫£m x√∫c N·ª¢"],
                "debtChart", "find-debt-status", "find-debt-desc",
                {
                    good: "Huy·∫øt √°p ·ªïn ƒë·ªãnh, ki·ªÉm so√°t n·ª£ vay tuy·ªát v·ªùi.",
                    bad: "Cao √°p! √Åp l·ª±c n·ª£ ƒëang ƒë√® n·∫∑ng l√™n d√≤ng ti·ªÅn.",
                    mid: "Huy·∫øt √°p h∆°i cao, c·∫ßn th·∫≠n tr·ªçng v·ªõi c√°c kho·∫£n vay m·ªõi."
                }
            );
        }
    </script>
    <!-- Floating PRO REPORT Button (New) -->
    <div class="floating-cta-report" onclick="openPaymentModal()">
        <div class="pulse-ring-report"></div>
        <div class="discount-badge">-80%</div>
        <div class="icon">üöÄ</div>
        <div class="text">FULL REPORT</div>
    </div>

    <!-- Floating Contact Button -->
    <div class="floating-contact">
        <div class="contact-menu">

            <a href="https://www.facebook.com/TuanDauTu68/" target="_blank" class="contact-item fb"
                title="Chat Facebook">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/2021_Facebook_icon.svg/2048px-2021_Facebook_icon.svg.png"
                    alt="Facebook">
            </a>

        </div>
        <div class="main-btn">
            <div class="pulse-ring"></div>
            <div class="icon">üí¨</div>
            <div class="text">Li√™n h·ªá</div>
        </div>
    </div>

    <style>
        /* Floating Report CTA Style */
        .floating-cta-report {
            position: fixed;
            bottom: 250px;
            /* Positioned higher to separate from contact button */
            right: 30px;
            z-index: 9999;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.5);
            transition: transform 0.3s;
            border: 3px solid white;
        }

        .floating-cta-report:hover {
            transform: scale(1.1);
        }

        .floating-cta-report .icon {
            font-size: 24px;
            margin-bottom: -2px;
            margin-top: 5px;
        }

        .floating-cta-report .text {
            font-size: 8px;
            font-weight: 800;
            text-align: center;
            line-height: 1.1;
        }

        .floating-cta-report .discount-badge {
            position: absolute;
            top: -5px;
            right: -10px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 10px;
            border: 2px solid white;
            animation: badge-bounce 2s infinite;
        }

        .pulse-ring-report {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #f59e0b;
            animation: ring-pulse 2s infinite;
        }

        @keyframes badge-bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }
    </style>

    <style>
        /* Container */
        .floating-contact {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 15px;
        }

        /* Main Button */
        .main-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0d9488, #0f766e);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(13, 148, 136, 0.4);
            position: relative;
            transition: transform 0.3s;
        }

        .main-btn:hover {
            transform: scale(1.1);
        }

        .main-btn .icon {
            font-size: 24px;
            margin-bottom: -2px;
        }

        .main-btn .text {
            font-size: 10px;
            font-weight: 700;
        }

        /* Pulse Animation */
        .pulse-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #0d9488;
            animation: ring-pulse 2s infinite;
        }

        @keyframes ring-pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Menu Items */
        .contact-menu {
            display: flex;
            /* Changed from none to flex but controlled by opacity/visibility for animation */
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Show menu on hover container */
        .floating-contact:hover .contact-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .contact-item {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s;
            text-decoration: none;
            font-size: 24px;
            position: relative;
        }

        .contact-item:hover {
            transform: scale(1.15);
        }

        .contact-item img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        /* Tooltip labels for items */
        .contact-item::after {
            content: attr(title);
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: #334155;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s;
        }

        .contact-item:hover::after {
            opacity: 1;
            visibility: visible;
        }
    </style>
    <!-- REPORT MODAL -->
    <div id="report-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h3>üöÄ Nh·∫≠n B√°o C√°o Chuy√™n S√¢u</h3>
                <p>Nh·∫≠p th√¥ng tin ƒë·ªÉ c·ªë v·∫•n t√†i ch√≠nh g·ª≠i ph√¢n t√≠ch & l·ªô tr√¨nh 90 ng√†y cho ri√™ng b·∫°n.</p>
            </div>
            <div class="modal-body">
                <form id="report-form">
                    <!-- Canvas ·∫©n ƒë·ªÉ v·∫Ω l·∫°i bi·ªÉu ƒë·ªì cho email -->
                    <div style="position: absolute; left: -9999px; top: -9999px;">
                        <canvas id="emailChartCanvas" width="500" height="500"></canvas>
                    </div>
                    <div class="form-group">
                        <label for="user-name">H·ªç v√† T√™n</label>
                        <input type="text" id="user-name" placeholder="VD: Nguy·ªÖn VƒÉn A" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email nh·∫≠n b√°o c√°o</label>
                        <input type="email" id="user-email" placeholder="VD: email@example.com" required>
                    </div>
                    <div class="form-note">
                        üîí Th√¥ng tin c·ªßa b·∫°n ƒë∆∞·ª£c b·∫£o m·∫≠t tuy·ªát ƒë·ªëi. Ch√∫ng t√¥i kh√¥ng bao gi·ªù spam.
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" id="btn-submit-report">
                        G·ª≠i B√°o C√°o Ngay
                    </button>
                    <div id="submit-loading" style="display: none; text-align: center; margin-top: 10px;">
                        <span class="spinner-small"></span> ƒêang k·∫øt n·ªëi v·ªõi c·ªë v·∫•n t√†i ch√≠nh, vui l√≤ng ch·ªù trong gi√¢y
                        l√°t ...
                    </div>
                    <div id="submit-error"
                        style="display: none; color: #E63946; text-align: center; margin-top: 10px; font-size: 0.9rem;">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL CSS -->
    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 450px;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(20px);
            animation: slideUp 0.3s forwards;
        }

        .modal-header {
            background: #264653;
            color: white;
            padding: 20px 24px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
        }

        .modal-header p {
            margin: 8px 0 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .modal-body {
            padding: 24px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close-modal:hover {
            opacity: 1;
        }

        .form-group {
            margin-bottom: 16px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #2D3748;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #E2E8F0;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.2s;
        }

        .form-group input:focus {
            border-color: #264653;
            outline: none;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .form-note {
            font-size: 0.8rem;
            color: #718096;
            margin-bottom: 20px;
            text-align: center;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
            }
        }

        .spinner-small {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-left-color: #264653;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <!-- REPORT LOGIC -->
    <script>
        // --- LOGIC V·∫º BI·ªÇU ƒê·ªí ·∫®N CHO EMAIL ---
        let emailChartInstance = null;
        function renderEmailChart() {
            const ctx = document.getElementById('emailChartCanvas').getContext('2d');

            // L·∫•y d·ªØ li·ªáu chi ti·∫øt t·ª´ localStorage
            let detailValues = Array(12).fill(0); // M·∫∑c ƒë·ªãnh
            try {
                const fullData = JSON.parse(localStorage.getItem('financeHealth_fullResult') || "[]");
                if (fullData.length > 0) {
                    // Map d·ªØ li·ªáu theo th·ª© t·ª± 1-12
                    detailValues = fullData.map(item => item.selectedValue);
                } else {
                    // Fallback URL params
                    const urlDetails = new URLSearchParams(window.location.search).get('details');
                    if (urlDetails) detailValues = urlDetails.split(',').map(Number);
                }
            } catch (e) { console.error("Error loading chat data", e); }

            const rawLabels = [
                "T·ª∑ l·ªá Chi Ti√™u", "Qu·∫£n L√Ω CT", "C·∫£m X√∫c CT",
                "TN th·ª• ƒë·ªông", "V·ªã th·∫ø TN", "Gia tƒÉng TN",
                "TS/Chi ph√≠", "C·∫•u tr√∫c TS", "Qu·∫£n L√Ω TS",
                "T·ª∑ l·ªá N·ª¢", "M·ª•c ƒë√≠ch N·ª¢", "C·∫£m x√∫c N·ª¢"
            ];

            const labels = rawLabels.map((label, i) => `${label} (${detailValues[i] || 0})`);

            // Ti√™u h·ªßy bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥
            if (emailChartInstance) emailChartInstance.destroy();

            emailChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S·ª©c kh·ªèe T√†i ch√≠nh (B·∫°n)',
                        data: detailValues,
                        backgroundColor: 'rgba(44, 110, 115, 0.5)',
                        borderColor: '#2C6E73',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#D4A373',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#D4A373'
                    },
                    {
                        label: 'Trung b√¨nh chung',
                        data: [4.1, 3.9, 5.4, 4.2, 4.2, 5.8, 4.1, 3.7, 3.5, 4.3, 3.6, 5.6], // Updated Hardcode benchmark
                        backgroundColor: 'rgba(0,0,0,0)',
                        borderColor: '#FF6B6B',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    animation: false, // T·∫Øt animation ƒë·ªÉ ch·ª•p ·∫£nh ƒë∆∞·ª£c ngay
                    responsive: false, // T·∫Øt responsive ƒë·ªÉ gi·ªØ size c·ªë ƒë·ªãnh
                    scales: {
                        r: {
                            min: 0, max: 7,
                            ticks: { stepSize: 1, display: false },
                            pointLabels: { font: { size: 14, family: 'Arial' }, color: '#333' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // G·ªçi v·∫Ω bi·ªÉu ƒë·ªì ngay khi trang load
        window.addEventListener('load', renderEmailChart);

        // Modal Logic
        const modal = document.getElementById('report-modal');
        const openBtn = document.querySelector('.next-step-cta button'); // N√∫t G·ª≠i B√°o C√°o
        const closeBtn = document.querySelector('.close-modal');
        const form = document.getElementById('report-form');

        if (openBtn) {
            openBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.style.display = 'flex';
            });
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', () => modal.style.display = 'none');
        }

        window.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
        });

        // Submit Logic (ƒê√£ update ph·∫ßn ch·ª•p ·∫£nh)
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit-report');
            const loading = document.getElementById('submit-loading');
            const errorDiv = document.getElementById('submit-error');

            const name = document.getElementById('user-name').value;
            const email = document.getElementById('user-email').value;

            // Retrieve Data
            const fullResultData = localStorage.getItem('financeHealth_fullResult');
            let parsedResult = [];
            try { parsedResult = fullResultData ? JSON.parse(fullResultData) : []; } catch (e) { }

            // 1. CH·ª§P ·∫¢NH T·ª™ CANVAS ·∫®N (emailChartCanvas) & 4 BI·ªÇU ƒê·ªí CHI TI·∫æT
            let chartImageBase64 = "";
            let costChartImg = "", incomeChartImg = "", assetChartImg = "", debtChartImg = ""; // NEW
            try {
                const chartCanvas = document.getElementById('emailChartCanvas');
                if (chartCanvas) chartImageBase64 = chartCanvas.toDataURL('image/png');

                // Capture details charts
                const c1 = document.getElementById('spendingChart');
                if (c1) costChartImg = c1.toDataURL('image/png');

                const c2 = document.getElementById('incomeChart');
                if (c2) incomeChartImg = c2.toDataURL('image/png');

                const c3 = document.getElementById('assetChart');
                if (c3) assetChartImg = c3.toDataURL('image/png');

                const c4 = document.getElementById('debtChart');
                if (c4) debtChartImg = c4.toDataURL('image/png');

            } catch (e) { console.warn("Chart Capture Error:", e); }

            // L·∫•y l·∫°i Score v√† Level t·ª´ URL ho·∫∑c LocalStorage
            const storedScore = localStorage.getItem('financeHealth_score');
            const storedLevel = localStorage.getItem('financeHealth_level');
            const storedTestTime = localStorage.getItem('financeHealth_testTime'); // L·∫•y gi·ªù test

            // TRICK: L·∫•y tr·ª±c ti·∫øp ƒëi·ªÉm ƒëang hi·ªán tr√™n m√†n h√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªìng nh·∫•t 100%
            let safeScore = 0;
            const uiScoreText = document.getElementById('level-val') ? document.getElementById('level-val').innerText : "";
            const uiScoreMatch = uiScoreText.match(/[\d\.]+/); // T√¨m s·ªë ƒë·∫ßu ti√™n (vd: 5.4)

            if (uiScoreMatch && uiScoreMatch[0]) {
                safeScore = parseFloat(uiScoreMatch[0]);
            } else {
                // Fallback c≈© n·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c t·ª´ UI
                safeScore = (typeof finalScore !== 'undefined') ? finalScore : (storedScore ? parseFloat(storedScore) : 0);
            }

            let safeLevel = (typeof currentLevel !== 'undefined') ? currentLevel : (storedLevel ? parseInt(storedLevel) : 0);

            // Prepare Payload
            const payload = {
                testTime: storedTestTime || new Date().toISOString(),
                name: name,
                email: email,
                level: safeLevel,
                score: safeScore.toFixed(2),
                chartImage: chartImageBase64, // ·∫¢nh radar ch√≠nh
                costChartImg: costChartImg,     // NEW
                incomeChartImg: incomeChartImg, // NEW
                assetChartImg: assetChartImg,   // NEW
                debtChartImg: debtChartImg,     // NEW
                details: parsedResult,
                overview: document.getElementById('doctor-msg') ? document.getElementById('doctor-msg').innerText : "",

                // --- NEW EXTENDED DATA FOR FREE EMAIL MATCHING RESULT PAGE ---
                levelDiagHtml: document.getElementById('level-diagnosis-content') ? document.getElementById('level-diagnosis-content').innerHTML : "",
                weakHtml: document.getElementById('weak-list') ? document.getElementById('weak-list').innerHTML : "",
                strongHtml: document.getElementById('strong-list') ? document.getElementById('strong-list').innerHTML : "",

                costDesc: document.getElementById('find-spending-desc') ? document.getElementById('find-spending-desc').innerText : "",
                incomeDesc: document.getElementById('find-income-desc') ? document.getElementById('find-income-desc').innerText : "",
                assetDesc: document.getElementById('find-asset-desc') ? document.getElementById('find-asset-desc').innerText : "",
                debtDesc: document.getElementById('find-debt-desc') ? document.getElementById('find-debt-desc').innerText : ""
            };

            console.log("üöÄ Payload Sent:", payload);

            // UI Interaction (Loading State)
            btn.style.display = 'none';
            loading.style.display = 'block';
            errorDiv.style.display = 'none';

            // L√†m m·ªù to√†n b·ªô form content ƒë·ªÉ n·ªïi b·∫≠t loading (bao g·ªìm c·∫£ note b·∫£o m·∫≠t)
            const elementsToDim = document.querySelectorAll('.form-group, .form-note');
            elementsToDim.forEach(el => {
                el.style.opacity = '0.3';
                el.style.pointerEvents = 'none';
            });

            try {
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby8jSZL4aub8dWhnHyzr8AnR9Ar7xE2_EUANqV5ZrT4xW7tXYXUNGnaSNWZaxI6AjMu/exec';
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                // Success Simulation
                // Success Simulation
                setTimeout(() => {
                    alert("‚úÖ ƒê√£ nh·∫≠n th√¥ng tin thanh to√°n!\n\nH·ªá th·ªëng s·∫Ω ki·ªÉm tra v√† g·ª≠i B√°o C√°o Chuy√™n S√¢u & L·ªô tr√¨nh h√†nh ƒë·ªông (ƒë∆∞·ª£c c√° nh√¢n h√≥a ri√™ng cho b·∫°n) v√†o email trong v√≤ng 24h.\n\nVui l√≤ng ki·ªÉm tra email th∆∞·ªùng xuy√™n.");
                    modal.style.display = 'none';

                    // Reset UI
                    btn.disabled = false;
                    btn.style.display = 'block';
                    btn.innerHTML = 'G·ª≠i B√°o C√°o Ngay';
                    loading.style.display = 'none';
                    elementsToDim.forEach(el => {
                        el.style.opacity = '1';
                        el.style.pointerEvents = 'auto';
                    });
                }, 2000); // TƒÉng th·ªùi gian ch·ªù gi·∫£ l·∫≠p l√™n 2s cho ng∆∞·ªùi d√πng ƒë·ªçc text loading

            } catch (err) {
                console.error(err);
                errorDiv.innerText = "L·ªói k·∫øt n·ªëi: " + err.message;
                errorDiv.style.display = 'block';

                // Reset UI for retry
                // Reset UI for retry
                btn.disabled = false;
                btn.style.display = 'block';
                btn.innerHTML = 'Th·ª≠ l·∫°i';
                loading.style.display = 'none';
                elementsToDim.forEach(el => {
                    el.style.opacity = '1';
                    el.style.pointerEvents = 'auto';
                });
            }
        });
    </script>
    <!-- Email Collection Modal -->
    <div id="emailModal" class="email-modal-overlay" style="display: none;">
        <div class="email-modal-content">
            <h3 class="modal-headline">Nh·∫≠p email ƒë·ªÉ nh·∫≠n k·∫øt qu·∫£ ph√¢n t√≠ch c√° nh√¢n h√≥a c·ªßa b·∫°n</h3>
            <p class="modal-sub">Ch√∫ng t√¥i s·∫Ω g·ª≠i b·∫£n sao k·∫øt qu·∫£ v√†o email ƒë·ªÉ b·∫°n c√≥ th·ªÉ xem l·∫°i b·∫•t c·ª© l√∫c n√†o.</p>
            <form id="emailForm" onsubmit="handleEmailSubmit(event)">
                <input type="email" id="userEmail" placeholder="Email c·ªßa b·∫°n..." required>
                <button type="submit" id="btnSubmitEmail">Nh·∫≠n k·∫øt qu·∫£ ngay</button>
            </form>
            <div id="submitMessage" style="margin-top: 10px; font-size: 0.9rem; display: none;"></div>
        </div>
    </div>

    <!-- Modal CSS -->
    <style>
        .email-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .email-modal-overlay.show {
            opacity: 1;
        }

        .email-modal-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .email-modal-overlay.show .email-modal-content {
            transform: scale(1);
        }

        .modal-headline {
            color: #1e293b;
            font-size: 1.5rem;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .modal-sub {
            color: #64748b;
            margin-bottom: 24px;
            font-size: 1rem;
        }

        #emailForm {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        #userEmail {
            padding: 14px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        #userEmail:focus {
            border-color: #0d9488;
        }

        #btnSubmitEmail {
            background: #0d9488;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }

        #btnSubmitEmail:hover {
            background: #0f766e;
        }

        #btnSubmitEmail:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
    </style>

    <!-- Modal Logic -->
    <script>
        // Run Immediately (Script is at end of body)
        // Run Immediately (Script is at end of body)
        // Check if user has visited this page in this session
        const hasVisited = sessionStorage.getItem('hasVisitedFinanceHealth');
        const delayTime = hasVisited ? 0 : 15000;

        // Helper: Get Cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return "";
        }

        setTimeout(() => {
            console.log("Triggering Email Modal...");
            const modal = document.getElementById('emailModal');
            // If email NOT submitted yet, show modal
            if (!sessionStorage.getItem('emailSubmitted')) {
                modal.style.display = 'flex';
                // Trigger reflow for animation
                modal.offsetHeight;
                modal.classList.add('show');

                // Mark as visited so next F5 is instant
                sessionStorage.setItem('hasVisitedFinanceHealth', 'true');
            } else {
                console.log("Email already submitted in this session.");
            }
        }, delayTime);

        async function handleEmailSubmit(e) {
            e.preventDefault();
            const emailInput = document.getElementById('userEmail');
            const submitBtn = document.getElementById('btnSubmitEmail');
            const msgDiv = document.getElementById('submitMessage');
            const email = emailInput.value.trim();

            if (!email) return;

            // UI Loading state
            submitBtn.innerHTML = 'ƒêang x·ª≠ l√Ω...';
            submitBtn.disabled = true;

            try {
                // 1. Prepare Data
                // Retrieve data from localStorage (saved by test.js)
                const fullResultData = JSON.parse(localStorage.getItem('financeHealth_fullResult') || '[]');
                const score = localStorage.getItem('financeHealth_score') || 0;
                const level = localStorage.getItem('financeHealth_level') || 0;
                const testTime = localStorage.getItem('financeHealth_testTime') || new Date().toISOString();

                // Capture chart images
                const chartCanvas = document.getElementById('resultChart');
                const costCanvas = document.getElementById('spendingChart');
                const incomeCanvas = document.getElementById('incomeChart');
                const assetCanvas = document.getElementById('assetChart');
                const debtCanvas = document.getElementById('debtChart');

                const chartBase64 = chartCanvas ? chartCanvas.toDataURL('image/png') : "";

                // 2. Send to Google Apps Script
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby8jSZL4aub8dWhnHyzr8AnR9Ar7xE2_EUANqV5ZrT4xW7tXYXUNGnaSNWZaxI6AjMu/exec';

                // Construct Payload - IMPORTANT: Reuse logic but ensure variable names don't conflict if inside another block
                // But this is inside handleEmailSubmit so it is fine.

                const payload = {
                    email: email,
                    name: "User", // Default name
                    score: score,
                    level: level,
                    details: fullResultData,
                    testTime: testTime,
                    chartImage: chartBase64,
                    costChartImg: costCanvas ? costCanvas.toDataURL('image/png') : "",
                    incomeChartImg: incomeCanvas ? incomeCanvas.toDataURL('image/png') : "",
                    assetChartImg: assetCanvas ? assetCanvas.toDataURL('image/png') : "",
                    debtChartImg: debtCanvas ? debtCanvas.toDataURL('image/png') : "",
                    logOnly: false,
                    affiliateId: getCookie('affiliate_id') || ""
                };

                console.log("Submitting Payload with AffiliateID:", payload.affiliateId);

                // Use no-cors mode
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                // 3. Success Handling
                sessionStorage.setItem('user_email', email);
                sessionStorage.setItem('emailSubmitted', 'true');

                // Close modal
                const modal = document.getElementById('emailModal');
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);

                alert("ƒêƒÉng k√Ω th√†nh c√¥ng! 1 B·∫£n b√°o c√°o c∆° b·∫£n s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ªõi email c·ªßa b·∫°n. N·∫øu b·∫°n c·∫ßn nh·ªØng th√¥ng tin n√¢ng cao v√† c√° nh√¢n h√≥a h∆°n, h√£y s·ª≠ d·ª•ng phi√™n b·∫£n n√¢ng cao (c√≥ tr·∫£ ph√≠)");

                // Schedule Comparison Popup after 60s
                const hasSeenPopup = localStorage.getItem('hasSeenComparisonPopup_v1');
                console.log("DEBUG: Email success. Checking popup status. hasSeenComparisonPopup_v1 =", hasSeenPopup);

                if (!hasSeenPopup) {
                    console.log("DEBUG: Scheduling Comparison Popup in 60s...");
                    setTimeout(() => {
                        console.log("DEBUG: 60s timeout reached. Triggering popup...");

                        const popupEl = document.getElementById('comparison-popup');
                        if (!popupEl) {
                            console.error("DEBUG: ERROR! Element #comparison-popup not found in DOM.");
                            return;
                        }

                        if (typeof window.showComparisonPopup === 'function') {
                            console.log("DEBUG: Calling window.showComparisonPopup()...");
                            window.showComparisonPopup();
                            localStorage.setItem('hasSeenComparisonPopup_v1', 'true');
                            console.log("DEBUG: Popup shown and localStorage updated.");
                        } else {
                            console.error("DEBUG: ERROR! window.showComparisonPopup is NOT a function.");
                            // Fallback direct manipulation
                            popupEl.style.display = 'flex';
                        }
                    }, 60000); // 60 seconds
                } else {
                    console.log("DEBUG: User has already seen popup. Skipping schedule.");
                }

            } catch (error) {
                console.error("Submission error:", error);
                msgDiv.innerHTML = "C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.";
                msgDiv.style.color = "red";
                msgDiv.style.display = "block";
                submitBtn.innerHTML = 'Nh·∫≠n k·∫øt qu·∫£ ngay';
                submitBtn.disabled = false;
            }
        }
    </script>

    <!-- PAYMENT MODAL & LOGIC NEW -->
    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal-overlay">
        <div class="payment-modal-container">
            <button class="close-payment-modal" onclick="closePaymentModal()">√ó</button>
            <div class="payment-header">
                <h3>Thanh to√°n Ph√≠ B√°o C√°o</h3>
                <div class="timer-badge" id="paymentTimer">05:00</div>
            </div>

            <div class="payment-body">
                <p class="payment-introd">Vui l√≤ng chuy·ªÉn kho·∫£n <strong>199.000 VNƒê</strong> v√† g·ª≠i ·∫£nh chuy·ªÉn kho·∫£n v√†o
                    √¥ b√™n d∆∞·ªõi ƒë·ªÉ ho√†n t·∫•t.</p>

                <div style="margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px;">
                    <input type="text" id="paymentName" placeholder="H·ªç v√† t√™n..."
                        style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; box-sizing: border-box; font-family: inherit;">
                    <input type="tel" id="paymentPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i..."
                        style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; box-sizing: border-box; font-family: inherit;">
                </div>

                <!-- Bank Info Placeholder -->
                <div class="bank-info-box">
                    <div id="bank-loading" class="loading-placeholder">
                        <span class="spinner-small"></span> ƒêang t·∫£i th√¥ng tin an to√†n...
                    </div>

                    <div id="qr-code-wrapper" class="qr-code-wrapper">
                        <img id="qr-img" class="qr-code-img" src="" alt="QR Chuy·ªÉn kho·∫£n" />
                        <p style="font-size: 0.8rem; color: #64748b; margin-top: 5px;">Qu√©t m√£ QR ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng
                            tin</p>
                    </div>

                    <table id="bank-table" class="bank-info-table">
                        <tr>
                            <td>Ng√¢n h√†ng:</td>
                            <td><strong id="b-name" style="color: #0f172a;">...</strong></td>
                        </tr>
                        <tr>
                            <td>S·ªë TK:</td>
                            <td>
                                <strong id="b-num"
                                    style="color: #0d9488; font-size: 1.1rem; letter-spacing: 0.5px;">...</strong>
                                <button class="copy-btn" onclick="copyToClipboard('b-num')" title="Sao ch√©p">üìã</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Ch·ªß TK:</td>
                            <td><strong id="b-owner" style="text-transform: uppercase;">...</strong></td>
                        </tr>
                        <tr>
                            <td>N·ªôi dung:</td>
                            <td>
                                <span id="b-content">...</span>
                                <button class="copy-btn" onclick="copyToClipboard('b-content')"
                                    title="Sao ch√©p">üìã</button>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="proof-upload-section">
                    <label for="paymentProof" class="upload-label">
                        <span class="upload-icon">üì∏</span>
                        <span>T·∫£i ·∫£nh x√°c nh·∫≠n chuy·ªÉn kho·∫£n</span>
                        <input type="file" id="paymentProof" accept="image/*" onchange="handleFileSelect(this)">
                    </label>
                    <div id="fileNameDisplay"
                        style="margin-top: 8px; font-size: 0.9rem; color: #0d9488; font-weight: 500;"></div>
                </div>

                <button id="btnConfirmPayment" class="btn-confirm-payment" onclick="submitPayment()">
                    X√°c nh·∫≠n ƒë√£ thanh to√°n
                </button>
            </div>
        </div>
    </div>

    <style>
        /* Payment Modal Styles */
        .payment-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .payment-modal-container {
            background: white;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            /* Limit height */
            overflow-y: auto;
            /* Enable scroll if content is too long */
            border-radius: 20px;
            padding: 30px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-payment-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .payment-header h3 {
            color: #0f172a;
            margin: 0 0 10px 0;
            font-size: 1.4rem;
        }

        .timer-badge {
            display: inline-block;
            background: #ffe4e6;
            color: #e11d48;
            font-weight: 800;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-family: monospace;
            border: 1px solid #fda4af;
        }

        .bank-info-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .bank-info-box .loading-placeholder {
            color: #64748b;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .bank-info-table {
            width: 100%;
            margin-top: 15px;
            text-align: left;
            border-collapse: collapse;
            display: none;
            /* Hidden until loaded */
        }

        .bank-info-table td {
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
            font-size: 0.95rem;
        }

        .bank-info-table td:first-child {
            font-weight: 600;
            color: #64748b;
            width: 100px;
        }

        .copy-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #0d9488;
            font-size: 0.9rem;
            margin-left: 5px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #e0f2fe;
        }

        .qr-code-wrapper {
            margin-bottom: 15px;
            display: none;
            /* Hidden until loaded */
        }

        .qr-code-img {
            max-width: 180px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #cbd5e1;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
            background: #f8fafc;
        }

        .upload-label:hover {
            border-color: #0d9488;
            background: #f0fdfa;
        }

        .upload-label input {
            display: none;
        }

        .btn-confirm-payment {
            width: 100%;
            background: #0d9488;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-confirm-payment:hover {
            background: #0f766e;
        }
    </style>


    <script>
        // Check URL Params for Upgrade Action
        window.addEventListener('load', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            const emailParam = urlParams.get('email');

            if (action === 'upgrade' && emailParam) {
                console.log("Auto-open Payment Modal for upgrade: " + emailParam);

                // 1. Save Email to Session
                const emailInput = document.getElementById('userEmail');
                if (emailInput) emailInput.value = emailParam;

                sessionStorage.setItem('user_email', emailParam);
                sessionStorage.setItem('emailSubmitted', 'true'); // Assume viewed report

                // 2. Open Payment Modal
                // Slight delay to ensure DOM is ready
                setTimeout(() => {
                    openPaymentModal();

                    // 3. Optional: Add default fake name/phone if empty to avoid validation block
                    // But maybe better to let them fill. Let's just focus field.
                    const nameField = document.getElementById('paymentName');
                    if (nameField && !nameField.value) nameField.focus();
                }, 500);

            }
        });

        // Payment Logic

        let timerInterval;
        const API_URL = 'https://script.google.com/macros/s/AKfycby8jSZL4aub8dWhnHyzr8AnR9Ar7xE2_EUANqV5ZrT4xW7tXYXUNGnaSNWZaxI6AjMu/exec';

        async function fetchBankInfo() {
            const loadingEl = document.getElementById('bank-loading');
            const qrWrapper = document.getElementById('qr-code-wrapper');
            const tableEl = document.getElementById('bank-table');
            const qrImg = document.getElementById('qr-img');

            // Reset UI
            loadingEl.style.display = 'flex';
            qrWrapper.style.display = 'none';
            tableEl.style.display = 'none';

            try {
                // Fetch secure config
                const res = await fetch(API_URL + '?action=getPaymentInfo');
                const data = await res.json();

                // Get User Info for Content
                let phone = document.getElementById('paymentPhone').value.trim()
                    || document.getElementById('user-phone')?.value
                    || sessionStorage.getItem('user_phone') || "SDT";

                const content = `${phone} Full Report`;

                // Update UI Text
                document.getElementById('b-name').textContent = data.bankName;
                document.getElementById('b-num').textContent = data.accountNum;
                document.getElementById('b-owner').textContent = data.ownerName;
                document.getElementById('b-content').textContent = content;

                // Load VietQR
                // Template: compact2 (Compact format)
                const bankID = data.bankID || "MB"; // Default MB
                const qrUrl = `https://img.vietqr.io/image/${bankID}-${data.accountNum}-compact2.png?amount=199000&addInfo=${encodeURIComponent(content)}&accountName=${encodeURIComponent(data.ownerName)}`;

                qrImg.src = qrUrl;

                // Show Content
                loadingEl.style.display = 'none';
                qrWrapper.style.display = 'block';
                tableEl.style.display = 'table';

            } catch (e) {
                console.error("Fetch Bank Info Error:", e);
                loadingEl.innerHTML = '<span style="color:red">L·ªói t·∫£i th√¥ng tin. Vui l√≤ng li√™n h·ªá Admin.</span>';
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("ƒê√£ sao ch√©p: " + text);
            }).catch(err => {
                console.error('L·ªói sao ch√©p', err);
            });
        }

        function openPaymentModal() {
            const modal = document.getElementById('paymentModal');
            modal.style.display = 'flex';
            startTimer(300); // 300 seconds
            fetchBankInfo(); // Call secure fetch
        }

        function closePaymentModal() {
            const modal = document.getElementById('paymentModal');
            modal.style.display = 'none';
            clearInterval(timerInterval);
        }

        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            const display = document.getElementById('paymentTimer');

            clearInterval(timerInterval); // Clear any existing

            timerInterval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(timerInterval);
                    display.textContent = "H·∫øt gi·ªù";

                    setTimeout(() => {
                        alert("ƒê√£ h·∫øt th·ªùi gian x√°c nh·∫≠n giao d·ªãch");
                        closePaymentModal();
                    }, 100);
                }
            }, 1000);
        }

        function handleFileSelect(input) {
            const display = document.getElementById('fileNameDisplay');
            if (input.files && input.files[0]) {
                display.textContent = "ƒê√£ ch·ªçn: " + input.files[0].name;
            } else {
                display.textContent = "";
            }
        }

        async function submitPayment() {
            const nameInput = document.getElementById('paymentName');
            const phoneInput = document.getElementById('paymentPhone');
            const fileInput = document.getElementById('paymentProof');

            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();

            // L·∫•y email t·ª´ input form tr∆∞·ªõc ƒë√≥ ho·∫∑c sessionStorage
            let email = document.getElementById('userEmail').value.trim();
            if (!email) email = sessionStorage.getItem('user_email') || "";

            if (!name) { alert("Vui l√≤ng nh·∫≠p H·ªç v√† t√™n!"); return; }
            if (!phone) { alert("Vui l√≤ng nh·∫≠p S·ªë ƒëi·ªán tho·∫°i!"); return; }
            if (!email) {
                // Fallback n·∫øu kh√¥ng t√¨m th·∫•y email
                email = prompt("Vui l√≤ng nh·∫≠p Email ƒë·ªÉ nh·∫≠n b√°o c√°o:");
                if (!email) return;
            }

            if (!fileInput.files || fileInput.files.length === 0) {
                alert("Vui l√≤ng t·∫£i l√™n ·∫£nh x√°c nh·∫≠n chuy·ªÉn kho·∫£n!");
                return;
            }

            const file = fileInput.files[0];
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert("File ·∫£nh qu√° l·ªõn (gi·ªõi h·∫°n 5MB). Vui l√≤ng ch·ªçn ·∫£nh nh·ªè h∆°n.");
                return;
            }

            const btn = document.getElementById('btnConfirmPayment');
            btn.innerHTML = 'ƒêang x·ª≠ l√Ω...';
            btn.disabled = true;

            // Helper to read file as Base64
            // Helper: Compress Image (Resize & Quality Reduction)
            const compressImage = (file, maxWidth, quality) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = event => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        let width = img.width;
                        let height = img.height;

                        // Resize if too big
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }

                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Compress to JPEG
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                    img.onerror = error => reject(error);
                };
                reader.onerror = error => reject(error);
            });

            try {
                // 1. Prepare Payment Proof
                const proofBase64 = await compressImage(fileInput.files[0], 1000, 0.7);

                // 2. Prepare Analysis Data (For Full Report Generation)
                const fullResultData = JSON.parse(localStorage.getItem('financeHealth_fullResult') || '[]');
                const score = localStorage.getItem('financeHealth_score') || 0;
                const level = localStorage.getItem('financeHealth_level') || 0;
                const testTime = localStorage.getItem('financeHealth_testTime') || new Date().toISOString();

                // Capture chart images again
                const chartCanvas = document.getElementById('resultChart');
                const costCanvas = document.getElementById('spendingChart');
                const incomeCanvas = document.getElementById('incomeChart');
                const assetCanvas = document.getElementById('assetChart');
                const debtCanvas = document.getElementById('debtChart');

                const payload = {
                    type: 'payment',
                    name: name,
                    phone: phone,
                    email: email, // Critical for sending email
                    proof: proofBase64,
                    // Analysis Data for Full Report
                    score: score,
                    level: level,
                    details: fullResultData,
                    chartImage: chartCanvas ? chartCanvas.toDataURL('image/png') : "",
                    costChartImg: costCanvas ? costCanvas.toDataURL('image/png') : "",
                    incomeChartImg: incomeCanvas ? incomeCanvas.toDataURL('image/png') : "",
                    assetChartImg: assetCanvas ? assetCanvas.toDataURL('image/png') : "",
                    debtChartImg: debtCanvas ? debtCanvas.toDataURL('image/png') : "",
                    // Affiliate Info (Passed to Backend for attribution)
                    affiliateId: (typeof getCookie === 'function') ? getCookie('affiliate_id') : "",
                    affiliateProductId: (typeof getCookie === 'function') ? getCookie('affiliate_product_id') : ""
                };

                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby8jSZL4aub8dWhnHyzr8AnR9Ar7xE2_EUANqV5ZrT4xW7tXYXUNGnaSNWZaxI6AjMu/exec';

                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                // ====== AFFILIATE TRACKING (MOVED TO SERVER SIDE) ======
                // Client-side tracking removed to ensure reliability and security via Code.gs
                /*
                try {
                    const affiliateId = getCookie('affiliate_id');
                    const productId = getCookie('affiliate_product_id');
                    if (affiliateId && productId) {
                       // ... logic moved to server ...
                    }
                } catch (affErr) {
                    console.warn('Affiliate tracking skipped:', affErr.message);
                }
                */
                // ================================


                // Success
                alert("‚úÖ ƒê√£ nh·∫≠n ƒë∆∞·ª£c th√¥ng tin thanh to√°n!\n\nEmail FULL B√°o C√°o Chuy√™n S√¢u (PDF) ƒëang ƒë∆∞·ª£c c·ªë v·∫•n t√†i ch√≠nh kh·ªüi t·∫°o v√† c√° nh√¢n h√≥a ƒë·ªÉ ph√π h·ª£p v·ªõi th·ª±c tr·∫°ng c·ªßa ri√™ng c√° nh√¢n b·∫°n. B√°o c√°o s·∫Ω ƒë∆∞·ª£c g·ª≠i trong v√≤ng 24h t·ªõi.\nVui l√≤ng ki·ªÉm tra email (c·∫£ m·ª•c Spam/Qu·∫£ng c√°o).");
                closePaymentModal();

            } catch (error) {
                console.error(error);
                alert("C√≥ l·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i!");
            } finally {
                btn.innerHTML = 'X√°c nh·∫≠n ƒë√£ thanh to√°n';
                btn.disabled = false;
            }
        }
    </script>

    <!-- COMPARISON POPUP MODAL (30s Trigger) -->
    <div id="comparison-popup" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 900px; padding: 0; background: transparent; box-shadow: none;">
            <div
                style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
                <!-- Header -->
                <div style="background: #e6fffa; padding: 40px 30px; text-align: center; position: relative;">
                    <span class="close-modal" onclick="closeComparisonPopup()"
                        style="position: absolute; top: 15px; right: 20px; font-size: 2rem; color: #0d9488; opacity: 0.7;">&times;</span>
                    <h2 style="color: #0f172a; font-size: 1.8rem; margin: 0 0 10px 0; line-height: 1.3;">T·∫°i sao b·∫°n n√™n
                        s·ªü h·ªØu <span style="color: #0d9488;">B·∫£n B√°o C√°o Chuy√™n S√¢u?</span></h2>
                    <p style="color: #64748b; font-size: 1.1rem;">S·ª± kh√°c bi·ªát gi·ªØa vi·ªác "bi·∫øt" v√† "th·ª±c s·ª± thay ƒë·ªïi"
                        n·∫±m ·ªü chi ti·∫øt.</p>
                </div>

                <!-- Grid Content -->
                <div class="comparison-grid-popup" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
                    <!-- Left: Basic -->
                    <div style="padding: 30px; background: #f8fafc; border-right: 1px solid #e2e8f0;">
                        <span
                            style="background: #94a3b8; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: inline-block; margin-bottom: 15px;">C∆†
                            B·∫¢N</span>
                        <h4 style="font-size: 1.4rem; color: #334155; margin-bottom: 5px; margin-top: 0;">B√°o C√°o Mi·ªÖn
                            Ph√≠</h4>
                        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 25px;">ƒê·ªß ƒë·ªÉ bi·∫øt b·∫°n ƒëang ·ªü ƒë√¢u.
                        </p>

                        <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                                <span style="color: #94a3b8;">‚úì</span> ƒêi·ªÉm s·ªë s·ª©c kh·ªèe t√†i ch√≠nh t·ªïng quan
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                                <span style="color: #94a3b8;">‚úì</span> X√°c ƒë·ªãnh C·∫•p ƒë·ªô t√†i ch√≠nh hi·ªán t·∫°i
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #475569;">
                                <span style="color: #94a3b8;">‚úì</span> Li·ªát k√™ c√°c ƒëi·ªÉm ngh·∫Ωn ch√≠nh
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #cbd5e1; text-decoration: line-through;">
                                <span style="color: #cbd5e1;">‚úï</span> Ph√¢n t√≠ch ƒêi·ªÉm m·∫°nh - ƒêi·ªÉm y·∫øu
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #cbd5e1; text-decoration: line-through;">
                                <span style="color: #cbd5e1;">‚úï</span> L·ªô tr√¨nh h√†nh ƒë·ªông 90 ng√†y c√° nh√¢n h√≥a
                            </li>
                        </ul>
                    </div>

                    <!-- Right: Premium -->
                    <div style="padding: 30px; background: white; position: relative;">
                        <div
                            style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #0d9488, #2dd4bf); color: white; padding: 6px 15px; border-bottom-left-radius: 16px; font-weight: 700; font-size: 0.8rem;">
                            KHUY√äN D√ôNG</div>

                        <span
                            style="background: linear-gradient(135deg, #0d9488, #2dd4bf); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: inline-block; margin-bottom: 15px;">CHUY√äN
                            S√ÇU</span>
                        <h4 style="font-size: 1.4rem; color: #1e293b; margin-bottom: 5px; margin-top: 0;">B√°o C√°o Full
                        </h4>
                        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 25px;">Gi·∫£i ph√°p tr·ªçn g√≥i ƒë·ªÉ thay
                            ƒë·ªïi.</p>

                        <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155; font-weight: 500;">
                                <span style="color: #0d9488; font-weight: 800;">‚úì</span> Bao g·ªìm t·∫•t c·∫£ t√≠nh nƒÉng Mi·ªÖn
                                ph√≠
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                                <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch s√¢u 12 ch·ªâ
                                    s·ªë</strong>
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                                <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>L·ªô tr√¨nh 90
                                    ng√†y</strong>
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                                <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch g√≥c nh√¨n t√¢m
                                    l√Ω</strong>
                            </li>
                            <li
                                style="margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                                <span style="color: #0d9488; font-weight: 800;">‚úì</span> <strong>Ph√¢n t√≠ch R·ªßi ro 4 h·∫°ng
                                    m·ª•c</strong>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Footer Action -->
                <div
                    style="padding: 20px 30px 30px 30px; text-align: center; background: white; border-top: 1px solid #f1f5f9;">
                    <button onclick="openPaymentModal(); closeComparisonPopup()"
                        style="background: linear-gradient(135deg, #0d9488, #2dd4bf); color: white; padding: 16px 50px; border: none; border-radius: 50px; font-weight: bold; font-size: 1.2rem; cursor: pointer; box-shadow: 0 10px 25px -5px rgba(13, 148, 136, 0.4); transition: transform 0.2s;">
                        M·ªü Kh√≥a B√°o C√°o Ngay üöÄ
                    </button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #94a3b8; cursor: pointer; text-decoration: underline;"
                        onclick="closeComparisonPopup()">T√¥i ch·ªâ mu·ªën xem b·∫£n mi·ªÖn ph√≠</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Styles for Popup Grid -->
    <style>
        .comparison-grid-popup {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 768px) {
            .comparison-grid-popup {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <!-- Script for Popup Logic -->
    <script>
        window.showComparisonPopup = function () {
            const popup = document.getElementById('comparison-popup');
            if (popup) popup.style.display = 'flex';
        }

        window.closeComparisonPopup = function () {
            const popup = document.getElementById('comparison-popup');
            if (popup) popup.style.display = 'none';
        }


    </script>

    <!-- ====== AFFILIATE TRACKING SDK ====== -->
    <script>
        const AFFILIATE_SERVICE_URL = 'https://affiliate.suckhoetaichinh.vn';

        const AFFILIATE_PRODUCT_SLUG = 'app1';

        // Helper: Set Cookie
        function setCookie(name, value, days) {
            const expires = new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = `${name}=${value}; expires=${expires}; path=/`;
        }

        // Helper: Get Cookie
        function getCookie(name) {
            return document.cookie.split('; ').reduce((r, v) => {
                const parts = v.split('=');
                return parts[0] === name ? decodeURIComponent(parts[1]) : r;
            }, '');
        }

        // Track Click on Page Load (if ?ref= exists in URL)
        (async function trackAffiliateClick() {
            const refCode = new URLSearchParams(window.location.search).get('ref');
            if (!refCode) return; // No referral code, skip

            try {
                const res = await fetch(`${AFFILIATE_SERVICE_URL}/api/v1/track/click`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productSlug: AFFILIATE_PRODUCT_SLUG, refCode })
                });
                const data = await res.json();
                if (data.success) {
                    setCookie('affiliate_id', data.affiliateId, data.cookieDuration || 30);
                    // L∆∞u productId v√†o cookie ƒë·ªÉ result.html d√πng khi track conversion
                    if (data.productId) {
                        setCookie('affiliate_product_id', data.productId, data.cookieDuration || 30);
                    }
                    console.log('‚úÖ Affiliate click tracked. Cookie set for', data.cookieDuration, 'days.');
                }
            } catch (e) {
                console.warn('Affiliate click tracking skipped:', e.message);
            }
        })();
    </script>
    <!-- ====================================== -->
</body>

</html>